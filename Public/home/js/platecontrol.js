var fid=$("h2").attr("f-id");var pn=$(".base_widget_paging").length==1?0:$(".base_widget_paging").find(".selected").find("a").html();var $selectForm=$(".dropdown_text_middle");var $oUl=$selectForm.find("ul");var islist=storetype==1?1:0;special=$selectForm.eq(0).find("span").attr("data-value"),dateline=$selectForm.eq(1).find("span").attr("data-value"),orderby=$selectForm.eq(2).find("span").attr("data-value"),digest=$(".essence").attr("data-value"),ofiltrate=$(".filtrate").attr("date-value");$(".theme_list").find(".theme_list_img").find("input[type=checkbox]").prop("checked",false);$("body").delegate(".bbsmodal .selectlist li","click",function(e){var s=$(this).html();var val=$(this).attr("data-value");$(this).parents(".dropdown_text_middle").children("span").html(s).attr("value",val);$(".selectlist").hide()});$("body").delegate(".bbsmodelfooter .txt","click",function(){var $checkwrap_i=$(this).find("i");if($checkwrap_i.hasClass("check_center")){$checkwrap_i.removeClass("check_center")}else{$checkwrap_i.addClass("check_center")}});var modelcon=function(classname,name,reason){var s='<div class="'+classname+'">';if(reason!=false){s+='<div class="handlereason">'+langgobale[45].string+'<span class="extendbtn"><i></i></span>\n                <ul>'+reason+'</ul>\n            </div>\n            <textarea></textarea>\n            <div class="bbsmodelfooter">\n                <span class="btn submit">'+langgobale[46].string+'</span>\n                <span class="txt">\n                    <span class="check_wrap noticauth"><i></i></span>'+langgobale[47].string+"</span>\n            </div>";addModel(name,s)}};var reasonList=function(){$("body").delegate(".handlereason li","click",function(){var l=$(this).html();$(".bbsmodal").find("textarea").val(l);$(this).parents("ul").fadeOut()})};$("body").delegate(".bbsmodal .closebtn","click",function(){var t=$(".bbsmodal_wrap").offset().top;$(".bbsmodal_wrap").remove();$("#ui-datepicker-div").hide();$(".flotation").show().css({top:t})});var removemodel=function(msg){var s1="<div class='modal_full in'>\n                <div class='modal-backdrop'></div>\n                <div class='modal'>\n                    <span class='close'></span>\n                    <h3>"+langgobale[150].string+"</h3>\n                <div>",s2="</div></div></div>";$("body").append(s1+msg+s2);$(".modal_full").fadeIn("normal",function(){setTimeout(function(){$(".modal_full").fadeOut("fast",function(){$(this).remove()})},1e3)})};var addModel=function(titlename,con){flotationHide();scoll=$(window).scrollTop();$(".bbsmodal").remove();var modal_s1="<div class='bbsmodal_wrap'><div class='bbsmodal'><h4>"+titlename+"<span class='closebtn'></span></h4>",modal_s2="</div></div>";$("body").append(modal_s1+con+modal_s2);$(".bbsmodal").show().css({top:"248px"})};var extendBtnClick=function(){$("body").delegate(".extendbtn","click",function(){$(this).siblings("ul").toggle()})};var submitPost=function(msg){$(".bbsmodal .submit").undelegate("click");$(".bbsmodal_wrap").remove();removemodel(msg)};function reasonFun(callback,obj){$.ajax({url:"/user/operationreason",type:"POST",dataType:"json",success:function(data){if(data.header.code==1e5){var r="",arr=data.body;for(var i=0,len=arr.length;i<len;i++){r+="<li>"+arr[i]+"</li>"}if(obj!="undefined"){callback(r,obj)}else{callback(r)}}else{removemodel(data.header.desc)}}})}var replyClose=function(top){$("body").delegate(".bbsmodal_wrap .closebtn","click",function(){$(".bbsmodal_wrap").remove();$(".flotation").show().css({top:top})})};var labelClick=function(){$("body").delegate(".changetheme label","click",function(){if($(this).find('input[type="checkbox"]').length>0){var o=$(this).find('input[type="checkbox"]');o.prop("checked",o[0].checked?false:true)}if($(this).find('input[type="radio"]').length>0){var o=$(this).find('input[type="radio"]');o.prop("checked",o[0].checked?false:true);$(".changetheme").find(".day").hide();if($(this).siblings(".day").length>0){$(this).siblings(".day").show()}}})};var changeRadio=function(){$("body").delegate(".selectwrap select","change",function(){$(".changetheme").show()})};var flotationstring="<div class='flotation'>\n                            <h4>"+langgobale[83].string+"<span class='themenum'>0</span>"+langgobale[78].string+"<span class='closebtn'></span>\n                                <span class='allcheck_txt'>"+langgobale[79].string+"</span>\n                                <input type='checkbox' name='allcheck'>\n                            </h4>\n                            <p>\n                                <span id='J_theme_delete'>"+langgobale[159].string+"</span>\n                                <span id='J_theme_openclose'>关闭打开</span>\n                                <span id='J_theme_fiseFall'>提升下沉</span>\n                                <span id='J_theme_highlight'>"+langgobale[143].string+"</span>\n                                <span id='J_theme_move'>移动</span>\n                            </p>\n                        </div>";if($(".themelistcon").length>0){$(".themelistcon").after(flotationstring);var $oFlotation=$(".flotation");$oFlotation.css({width:"248px"}).find("p").css({margin:"20px 0 15px 18px"})}var flotationarr=new Array;$(".contain_right").on("click",".themelistcon input",function(){var $oInput=$(".themelistcon input"),$oFlotation=$(".flotation"),$oThemenum=$oFlotation.find(".themenum");$oFlotation.find(".allcheck_txt,input").show();var val=parseInt($oThemenum.html()),$oLi=$(this).parents("li"),post_id=$oLi.attr("t-id");if(!$(this)[0].checked){var i=$.inArray(post_id,flotationarr);flotationarr.splice(i,1);val--}else{flotationarr.push(post_id);val++}$("[name = allcheck]:checkbox").prop("checked",$oInput.length==$oInput.filter(":checked").length?true:false);if(val==0){$oFlotation.hide()}else{var topnum=$(this).parents("li").offset().top;topnum-=300;$oFlotation.show().css({top:topnum})}$oThemenum.html(val)});$(".contain_right").delegate(".flotation .closebtn","click",function(){var $oFlotation=$(".flotation"),$oInput=$(".themelistcon input"),$oThemenum=$oFlotation.find(".themenum");$oInput.prop("checked",false);$oFlotation.hide();$oThemenum.html(0);flotationarr=[]});$("[name = allcheck]:checkbox").on("click",function(){var $oInput=$(".themelistcon input"),$oFlotation=$(".flotation"),$oThemenum=$oFlotation.find(".themenum");$oInput.prop("checked",this.checked);if($oInput.length==$oInput.filter(":checked").length){$oThemenum.html($oInput.length);flotationarr=[];for(var i=0;i<$oInput.length;i++){var a=$oInput.eq(i).parents("li").attr("t-id");flotationarr.push(a)}}else{$oFlotation.hide();$oThemenum.html(0);flotationarr=[]}});var flotationHide=function(){var flotationtop=parseInt($(".flotation").css("top"));$oFlotation.hide()};var modelDelete=function(r){var flotationtop=parseInt($(".flotation").css("top"));modelcon("modeldelete",langgobale[159].string,r);$(".modeldelete").prepend("<h5>"+langgobale[163].string+"?</h5>");replyClose(flotationtop)};$(".contain_right").delegate("#J_theme_delete","click",function(){reasonFun(modelDelete)});$("body").delegate(".modeldelete .submit","click",function(){var reason=$(".bbsmodal").find("textarea").val();if(!reason){removemodel(langgobale[77].string);return false}var data={fid:fid,pn:pn,special:special,dateline:dateline,orderby:orderby,digest:digest,ofiltrate:ofiltrate,islist:islist,threadIds:flotationarr,reason:reason,notice:$(".noticauth").find("i").hasClass("check_center")?1:0};$.ajax({url:"/thread/multiDelete",data:data,type:"POST",dataType:"json",success:function(data){if(data.header.code==500005){delCallback(flotationarr,data.header.desc)}else{removemodel(data.header.desc)}}})});function delCallback(arr,msg){submitPost(msg);var $oInput=$(".themelistcon input"),$oFlotation=$(".flotation"),$oThemenum=$oFlotation.find(".themenum"),$oitem=$(".theme li");if(arr.length==$oitem.length){$(".themelistcon").remove()}else{for(var o=0,len=$oitem.length;o<len;o++){for(var i=0;i<len;i++){if(arr[i]==$oitem.eq(o).attr("t-id")){$oitem.eq(o).remove()}}}}$oThemenum.html(0);$oFlotation.css("top","100px").hide();flotationarr=[]}var modelClose=function(r){modelcon("modelclose",langgobale[92].string,r);$(".modelclose").prepend('<div class="day">'+langgobale[103].string+'<input type="text" readonly="readonly" xtype="day" size="15" class="datePicker"/>\n                            </div>\n                            <div class="changetheme">\n                                <label>\n                                    <input type="radio" name="closeopen" data-name="open"/>'+langgobale[93].string+'</label>\n                            </div>\n                            <div class="changetheme">\n                                <label>\n                                    <input type="radio" name="closeopen"  data-name="close"/>'+langgobale[94].string+"</label>\n                            </div>").find('input[type="radio"]').eq(0).prop("checked",true);$(".datePicker").datepicker()};$(".contain_right").delegate("#J_theme_openclose","click",function(){reasonFun(modelClose)});$("body").delegate(".modelclose .submit","click",function(){var $oclose=$(".modelclose"),reason=$oclose.find("textarea").val();if(!reason){removemodel(langgobale[77].string);return false}var data={fid:fid,tid:flotationarr,reason:reason,datelineclose:$oclose.find("input[xtype=day]").val(),op:[$oclose.find("input:radio:checked").attr("data-name")],notify:$oclose.find(".noticauth i").hasClass("check_center")?1:0};$.ajax({url:"/thread/MultiManages",data:data,type:"POST",dataType:"json",success:function(data){if(data.header.code==500005){window.location.reload()}else{removemodel(data.header.desc)}}})});var modelFiseFall=function(r){modelcon("modelfisefall",langgobale[92].string,r);$(".modelfisefall").prepend('<div class="changetheme clearfix">\n                                    <label>\n                                        <input type="radio" name="fisefall" data-name="bump"/>'+langgobale[104].string+'</label>\n                                    <div class="day">'+langgobale[103].string+'<input type="text" xtype="day" readonly="readonly"  size="20" class="datePicker"/>\n                                    </div>\n                                </div>\n                                <div class="changetheme clearfix">\n                                    <label>\n                                        <input type="radio" name="fisefall" data-name="down"/>'+langgobale[105].string+"</label>\n                                </div>").find('input[name="fisefall"]').eq(0).prop("checked",true);$(".datePicker").datepicker();$(".modelfisefall .day").show()};$("body").delegate(".modelfisefall label","click",function(){$(this).parents(".changetheme").find(".day").toggle()});$(".contain_right").delegate("#J_theme_fiseFall","click",function(){reasonFun(modelFiseFall)});$("body").delegate(".modelfisefall .submit","click",function(){var $ofisefall=$(".modelfisefall");var reason=$ofisefall.find("textarea").val();if(!reason){removemodel(langgobale[77].string);return false}var data={tid:flotationarr,op:[$ofisefall.find("input:radio:checked").attr("data-name")],reason:reason,notify:$ofisefall.find(".noticauth i").hasClass("check_center")?1:0};if(data.op[0]=="bump"){data.datelinebump=$ofisefall.find('input[xtype="day"]').val()}$.ajax({url:"/thread/MultiManages",data:data,type:"POST",dataType:"json",success:function(data){if(data.header.code==500005){submitPost(data.header.desc)}else{removemodel(data.header.desc)}}})});var reg=/^#([0-9a-fA-f]{3}|[0-9a-fA-f]{6})$/;String.prototype.colorHex=function(){var that=this;if(/^(rgb|RGB)/.test(that)){var aColor=that.replace(/(?:\(|\)|rgb|RGB)*/g,"").split(",");var strHex="#";for(var i=0;i<aColor.length;i++){var hex=Number(aColor[i]).toString(16);if(hex==="0"){hex+=hex}strHex+=hex}if(strHex.length!==7){strHex=that}return strHex}else if(reg.test(that)){var aNum=that.replace(/#/,"").split("");if(aNum.length===6){return that}else if(aNum.length===3){var numHex="#";for(var i=0;i<aNum.length;i+=1){numHex+=aNum[i]+aNum[i]}return numHex}}else{return that}};var bbsObj="";var modelStick=function(r){modelcon("modelstick",langgobale[92].string,r);var fenleistick='<li data-value="1">'+langgobale[136].string+"</li>",platestick='<li data-value="2">'+langgobale[137].string+"</li>",globalstick='<li data-value="3">'+langgobale[138].string+"</li>";var sticks='<div class="changetheme stickwrap clearfix">\n                    <div class="clearfix">\n                        <label>\n                            <input type="checkbox" name="box" />'+langgobale[82].string+'</label>\n                        <div class="dropdown_text_middle">\n                            <span value="0">'+langgobale[42].string+'</span>\n                            <i></i>\n                            <ul class="selectlist clearfix">\n                                <li data-value="0">'+langgobale[42].string+"</li>"+platestick+fenleistick+globalstick+'</ul>\n                        </div>\n                    </div>\n                    <div class="day">'+langgobale[103].string+'<input readonly="readonly" type="text" xtype="day" size="15" class="datePicker"/>\n                    </div>\n                </div>';var classify1='<li data-value="1">'+langgobale[140].string+"</li>",classify2='<li data-value="2">'+langgobale[141].string+"</li>",classify3='<li data-value="3">'+langgobale[142].string+"</li>";var digest='<div class="changetheme digestwrap clearfix">\n                    <div class="clearfix">\n                        <label>\n                            <input type="checkbox" name="box" />'+langgobale[139].string+'</label>\n                        <div class="dropdown_text_middle">\n                            <span value="0">'+langgobale[118].string+'</span>\n                            <i></i>\n                            <ul class="selectlist clearfix">\n                                <li data-value="0">'+langgobale[118].string+"</li>"+classify1+classify2+classify3+'</ul>\n                        </div>\n                    </div>\n                    <div class="day">'+langgobale[103].string+'<input type="text" readonly="readonly" xtype="day" size="15" class="datePicker"/>\n                    </div>\n                </div>';var $omodelstick=$(".modelstick");var colorArr=["#6ea930","#f57c00","#ef5350","#488eee","#9575cd","#a67c52","#333"];var colorString="";for(var i=0,len=colorArr.length;i<len;i++){colorString+="<span>"+colorArr[i]+"</span>"}$omodelstick.prepend(sticks+digest+'<div class="changetheme bumpwrap clearfix">\n                            <div class="clearfix">\n                                <label>\n                                    <input type="checkbox" name="box" />'+langgobale[144].string+'</label>\n                            </div>\n                            <div class="day">'+langgobale[103].string+'<input type="text" xtype="day" readonly="readonly" size="15" class="datePicker"/>\n                            </div>\n                        </div>\n                        <div class="changetheme highlightwrap clearfix">\n                            <label>\n                                <input type="checkbox" name="box" />'+langgobale[143].string+'</label>\n                            <div class="bg">\n                                <span></span>\n                                <div class="color_wrap">'+colorString+'</div>\n                        </div>\n                            <span class="bold modify" data-value="0">B</span>\n                            <span class="italic modify" data-value="0">I</span>\n                            <span class="underline modify" data-value="0">U</span>\n                            <div class="day">'+langgobale[103].string+'<input type="text" xtype="day" readonly="readonly" size="15" class="datePicker"/>\n                            </div>\n                        </div>\n                        </div>');$(".datePicker").datepicker();var oSpan=$(".modelstick .color_wrap").find("span");for(var i=0,len=oSpan.length;i<len;i++){oSpan.eq(i).css({background:oSpan.eq(i).html()})}var n=bbsObj[0].id;var num="";if(n=="stick"){num=0}else if(n=="essence"){num=1}else if(n=="提升"){num=2}else if(n=="J_theme_highlight"){num=3}$('.modelstick label input[name="box"]').eq(num).click()};$(".contain_right").delegate("#J_theme_highlight","click",function(){bbsObj=$(this);reasonFun(modelStick)});$("body").delegate(".modelstick label","click",function(){$(this).parents(".changetheme").find(".day").toggle()});$("body").delegate(".modify","click",function(){var value=$(this).attr("data-value");if(value==0){$(this).addClass("current")}else{$(this).removeClass("current")}$(this).attr("data-value",value=="0"?1:0)});$("body").delegate(".color_wrap span","click",function(){$(this).parent().siblings("span").css({background:$(this).html()})});$("body").delegate(".modelstick .bg","click",function(){$(this).find(".color_wrap").toggle()});$("body").delegate(".modelstick .submit","click",function(){var $ostick=$(".modelstick");var reason=$ostick.find("textarea").val();if(!reason){removemodel(langgobale[77].string);return false}if($ostick.find("input:checkbox:checked").length>0){var data={tid:flotationarr,op:[],reason:reason,notify:$ostick.find(".noticauth i").hasClass("check_center")?1:0};var oStick=$(".stickwrap");if(oStick.length==1){if(oStick.find("input").eq(0)[0].checked){data.op.push("stick");data.sticklevel=oStick.find("span").attr("value");data.datelinestick=oStick.find('input[xtype="day"]').val()}}var oDigest=$(".digestwrap");if(oDigest.length==1){if(oDigest.find("input").eq(0)[0].checked){data.op.push("digest");data.digestlevel=oDigest.find("span").attr("value");data.datelinedigest=oDigest.find('input[xtype="day"]').val()}}var oBump=$(".bumpwrap");if(oBump.length==1){if(oBump.find("input").eq(0)[0].checked){data.op.push("bump");data.datelinebump=oBump.find('input[xtype="day"]').val()}}var oHighlight=$(".highlightwrap");if(oHighlight.length==1){if(oHighlight.find("input").eq(0)[0].checked){data.op.push("highlight");highlight_color=oHighlight.find(".bg").eq(0).find("span").eq(0).css("background-color");data.highlight_color=highlight_color.colorHex();data.highlight_style=new Array;var $omodify=$ostick.find(".modify");for(var i=0,l=$omodify.length;i<l;i++){data.highlight_style[i]=$omodify.eq(i).attr("data-value")}data.datelinehighlight=oHighlight.find('input[xtype="day"]').val()}}$.ajax({url:"/thread/MultiManages",data:data,type:"POST",dataType:"json",success:function(data){if(data.header.code==500005){submitPost(data.header.desc)}else{removemodel(data.header.desc)}}})}else{removemodel(langgobale[106].string)}});var modelMove=function(r,data){modelcon("modelmove",langgobale[92].string,r);var plateList="",plateval="",platename="",classifystr="",classifyval="",classifyname="";for(var name in data.forum){if(name==fid){plateval=name;platename=data.forum[name]}plateList+='<li data-value="'+name+'">'+data.forum[name]+"</li>"}var i=0;for(var name in data.type){if(i==0){classifyval=name;classifyname=data.type[name];i++}classifystr+='<li data-value="'+name+'">'+data.type[name]+"</li>"}$(".modelmove").prepend('<div class="selectwrap clearfix">\n                                <label>'+langgobale[99].string+'：</label>\n                                <div class="dropdown_text_middle">\n                                    <span value="'+plateval+'">'+platename+'</span>\n                                    <i></i>\n                                    <ul class="selectlist">'+plateList+'</ul>\n                                </div>\n                            </div>\n                            <div class="selectwrap clearfix">\n                                <label>'+langgobale[98].string+'：</label>\n                                <div class="dropdown_text_middle">\n                                    <span value="'+classifyval+'">'+classifyname+'</span>\n                                    <i></i>\n                                    <ul class="selectlist">'+classifystr+'</ul>\n                                </div>\n                            </div>\n                            <div class="changetheme">\n                                <label>\n                                    <input type="radio" name="moveto" data-value="0"/>'+langgobale[100].string+'</label>\n                            </div>\n                            <div class="changetheme">\n                                <label>\n                                    <input type="radio" name="moveto" data-value="1"/>'+langgobale[101].string+"</label>\n                            </div>")};$(".contain_right").delegate("#J_theme_move","click",function(){$.ajax({url:"/thread/topicManage",data:{fid:fid,op:["move"]},type:"POST",dataType:"json",success:function(data){if(data.header.code==500005){reasonFun(modelMove,data.body)}else{removemodel(data.header.desc)}}})});$("body").delegate(".modelmove .selectlist:eq(0) li","click",function(){var forum_id=$(this).attr("data-value");$.ajax({url:"/thread/topicManage",data:{fid:forum_id,op:["move"]},type:"POST",dataType:"json",success:function(data){if(data.header.code==500005){var val=data.body.type;var str="";if(val){if(val.length!=0){var n=0;for(var name in val){if(n++==0){$(".modelmove .dropdown_text_middle:eq(1) span").attr("value",name).html(val[name])}str+='<li data-value="'+name+'">'+val[name]+"</li>"}}else{str=langgobale[42].string}}else{$(".modelmove .dropdown_text_middle:eq(1) span").attr("value",0).html(langgobale[42].string);str=""}$(".modelmove").find(".selectlist").eq(1).html(str)}else{removemodel(data.header.desc)}}})});$("body").delegate(".modelmove .submit","click",function(){var $omove=$(".modelmove");var reason=$omove.find("textarea").val();if(!reason){removemodel(langgobale[77].string);return false}var $omoveselect=$omove.find(".dropdown_text_middle"),moveforum_id=$omoveselect.eq(0).find("span").attr("value"),movetypeid=$omoveselect.eq(1).find("span").attr("value");if(moveforum_id==0||movetypeid==0){removemodel(langgobale[102].string);return false}var data={tid:flotationarr,op:["move"],reason:reason,fid:moveforum_id,typeid:movetypeid,notify:$omove.find(".noticauth i").hasClass("check_center")?1:0};$.ajax({url:"/thread/MultiManages",data:data,type:"POST",dataType:"json",success:function(json){if(json.header.code==500005){window.location.reload()}else{removemodel(json.header.desc)}}})});var init=function(){reasonList();extendBtnClick();labelClick();changeRadio()};init();function mouseMove($obj,left,pdl,pdt,e){e.stopPropagation();var scollt=window.pageYOffset||document.documentElement.scrollTop||document.body.scrollTop||0;var isMove=true;var abs_x=e.pageX-$obj.offset().left-left;var abs_y=e.pageY-$obj.offset().top+scollt;$(document).mousemove(function(event){e.stopPropagation();if(isMove){var obj=$obj;var l=event.pageX-abs_x;var t=event.pageY-abs_y;var w=$(window).width();var h=$(window).height();var obj_w=obj.width()+pdl-left;var obj_h=obj.height()+pdt;if(l>left&&l<w-obj_w&&t>0&&t-scollt<h-obj_h){obj.css({left:l,top:t,"margin-top":"0"})}}}).mouseup(function(){isMove=false})}$("body").delegate(".bbsmodal h4","mousedown",function(event){mouseMove($(this).parent(),245,0,0,event)});