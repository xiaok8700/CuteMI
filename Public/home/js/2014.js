OO(["com.mi.utils.time","com.mi.utils.Cookie","com.mi.widgets.sms","com.mi.passport.mibao","com.mi.utils.L11N","com.mi.utils.URL","com.mi.utils.Tip"],"com.mi.passport.portal.2014",function(q,l,h,v,o,i,w,j){window._tickRequests=[];function d(B,D){D=D||"0";var C=(+new Date)+"";var A="/pass/ajax/tick?_t="+C+"&biz="+B+"&step="+D;var y=_tickRequests.length;var z=_tickRequests[y]=new Image;z.onload=z.onerror=function(){z=_tickRequests[y]=null};z.src=A}function u(){location.reload(true)}function r(){location.reload(true)}function x(){var y=l.get("userId");if(y&&!isNaN(y)){if(y!==$(".na-num").text()){r();return false}return true}else{u();return false}}var b="";function k(y){b=y;location.hash=y}$.parseJSONSafe=function(y){try{return $.parseJSON(y)}catch(z){return{code:5000000,result:5000000,description:"Not JSON"}}};$.fn.showError=function(y){if(!y){y=""}else{y=""+y}return this.each(function(A,C){var z=$(C);if(z.hasClass("quota_tip")){return}var D=z.attr("_text");if(D&&y){var B=y.charAt(0);if(B==="5"){z.text(D+"("+y+")").show()}else{z.text(D).show()}}else{z.text(D).show()}})};$.fn.hideError=function(){return this.each(function(z,A){var y=$(A);if(y.hasClass("quota_tip")){return}var B=y.attr("_text");if(B){y.text(B).hide()}else{y.hide()}})};$.fn.showPopup=function(){this.each(function(A,B){var z=$(B),y=z.closest(".popup_mask");if(y.length){y.show()}z.show();switch(B.id){case"popManageTokenStatus":case"popManageTokenKeys":z.positionPopup();default:}switch(B.id){case"popManageTokenStatus":case"popManageTokenHome":k("#service=setToken");break;case"popUpdatePassword":k("#service=setPassword");break;case"popEnterNewEmail":k("#service=bindEmail");break;case"popEnterNewPhone":k("#service=bindPhone");break;case"popSetMibao":case"popAnswerMibao":case"popFinishMibao":k("#service=setMibao");break;case"popSuicideWarning":k("#service=suicide");break;default:}});if($(".popup_mask:visible").length){$(document.body).css({"overflow-y":"hidden"})}else{}return this};$.fn.hidePopup=function(y){y=y||{};this.each(function(B,C){var A=$(C),z=A.closest(".popup_mask");if(z.length){z.hide()}A.hide();if(!y.dontAffectHash){switch(C.id){case"popUpdatePassword":case"popEnterNewEmail":case"popEnterNewPhone":case"popSetMibao":case"popAnswerMibao":case"popFinishMibao":case"popManageTokenStatus":case"popManageTokenHome":case"popSuicideWarning":case"popSuicidePrompt":case"popSuicideSuccess":case"popSuicideFailure":if(location.hash){k("#")}break;default:}}});if($(".popup_mask:visible").length){$(document.body).css({"overflow-y":"hidden"})}else{$(document.body).css({"overflow-y":"scroll"})}return this};$.fn.positionPopup=function(){return this.each(function(A,B){var z=$(B);var y=$(window).height();var C=B.offsetHeight;if(C>y){z.css("top","0")}else{z.css("top",Math.round((y-C)/2)+"px")}})};$(function(){$(".err_tip, .txt_tip").each(function(z,A){var y=$(A);y.attr("_text",y.text())})});function p(y){if(y){if(y.code&&y.code!=3001){var z=$("#popVeriFailed");z.find(".err_code").text(y.code);z.showPopup()}}}var f=j.$class({constructor:function(){this.$passwordMgr=$("[_role=passwordMgr]");this.$emailMgr=$("[_role=emailMgr]");this.$phoneMgr=$("[_role=phoneMgr]");this.$mibaoMgr=$("[_role=mibaoMgr]");this.$tokenMgr=$("[_role=tokenMgr]")},syncHash:function(){var z=i.parse(location.hash);var A=location.hash;if(A===b){return}var y=z.service||"";b=A;switch(y){case"bindPhone":d("changePhone");$("#btnUpdatePhone").click();break;case"bindEmail":d("changeEmail");$("#btnUpdateEmail").click();break;case"setMibao":$("#btnSetMibao").click();break;case"setPassword":d("changePassword");$("#btnUpdatePassword").click();break;case"setToken":d("enableTwoStepLogin");$("#btnManageToken").click();break;case"suicide":d("delAccount");this.suicide();break;default:$("#popUpdatePassword, #popEnterNewEmail, #popEnterNewPhone, #popSetMibao, #popAnswerMibao, #popFinishMibao, #popManageTokenStatus, #popSuicideWarning, #popManageTokenHome, #popManageTokenStatus").hidePopup()}},render:function(){this.uiBind();this.syncHash();setInterval(j.proxy(function(){this.syncHash()},this),500)},phoneImageBlurTimer:null,emailImageBlurTimer:null,suicide:function(){var y=$("#popSuicideWarning");y.find(".twostep_trustinfo").removeClass("now");y.find(".err_tip").hideError();y.showPopup();$.ajax({type:"GET",url:"/pass/auth/security/getAccountStatus",data:{userId:$(".na-num").text()},dataType:"text",success:function(B){B=B.replace("&&&START&&&","");B=$.parseJSONSafe(B);var A=+B.result;if(A===0){var z=+B.info.leftTimes;if(z<=1){y.find(".warn-text").show()}}else{y.find(".sys_err").showError(A)}}})},uiBind:function(){$("#popSuicideWarning .twostep_trustinfo").click(function(M){var N=$("#popSuicideWarning");var O=$(M.currentTarget);O.toggleClass("now");if(N.find(".sys_err:visible").length){N.find(".btn_commom").addClass("disabled")}else{if(O.hasClass("now")){N.find(".btn_commom").removeClass("disabled")}else{N.find(".btn_commom").addClass("disabled")}}});$("#popSuicideWarning .btn_commom").click(j.proxy(function(N){N.preventDefault();var O=$(N.currentTarget);if(O.hasClass("disabled")){return}$("#popSuicideWarning").hidePopup({dontAffectHash:true});var M=false;MiAccountVerification({url:"/pass/auth/security/del?userId="+$(".na-num").text(),user:$(".na-num").text(),success:j.proxy(function(){M=true;$("#popSuicideWarning").hidePopup({dontAffectHash:true});$("#popSuicidePrompt").showPopup()},this),fail:function(P){if(M){return}$("#popSuicideWarning").showPopup();p(P)}})},this));$("#popSuicidePrompt .btn_commom").click(function(M){M.preventDefault();var N=$("#popSuicidePrompt");$.ajax({type:"POST",url:"/pass/auth/security/del",data:{passport_ph:l.get("passport_ph")||"",passportsecurity_ph:l.get("passportsecurity_ph")||"",passToken:l.get("passToken")||"",userId:$(".na-num").text()},dataType:"text",success:function(P){P=P.replace("&&&START&&&","");P=$.parseJSONSafe(P);var O=+P.result;if(O===0){$("#popSuicidePrompt").hidePopup({dontAffectHash:true});$("#popSuicideSuccess").showPopup();var Q=new q.Countdown({duration:10000,onProgress:function(R){$("#popSuicideSuccess .wapbox p span").text(Math.round(R.timeLeft/1000))},onComplete:function(){location.href="/"}});Q.start()}else{switch(O){case 1200603:case 5200604:case 5200605:N.find(".sys_err").showError(O);default:}}}})});$("#popSuicideWarning .btn_back, #popSuicidePrompt .btn_back, #popSuicideSuccess .btn_back, #popSuicideFailure .btn_back").click(function(M){M.preventDefault();$(M.target).closest(".mod_acc_tip").hidePopup()});$(document.body).delegate(".mod_acc_tip .btn_mod_close, .mod_acc_tip .btn_close_popup","click",function(M){M.preventDefault();var N=$(M.target).closest(".mod_acc_tip"),O=N.attr("id");switch(O){case"popManageTokenSetMobile":$("#popManageTokenStatus").showPopup().find(".err_tip").hide();N.hidePopup();break;case"popManageTokenKeys":$("#popManageTokenStatus").showPopup().find(".err_tip").hide();N.hidePopup();break;case"popManageTokenDisableFinish":location.href="/";break;case"popManageTokenFinish":location.href="/";break;case"popEnterNewPhone":if(N.find("dl.success:visible").length){location.href="/"}else{N.hidePopup()}break;case"popEnterNewEmail":if(N.find("dl.success:visible").length){location.href="/"}else{N.hidePopup()}break;case"popSetMibao":location.href="/";break;default:N.hidePopup()}});$(document.body).delegate(".icon_false, .icon_true","click",function(O,N){O.preventDefault();var M=$(O.target);if($(window).innerWidth()<=770){if(M.closest("#popManageTokenTrustDevice").length){O.stopPropagation()}}if(M.hasClass("icon_false")){M.removeClass("icon_false").addClass("icon_true")}else{M.removeClass("icon_true").addClass("icon_false")}});$("#popManageTokenTrustDevice .mod_trust").click(function(N){if($(window).innerWidth()<=770){var M=$("#popManageTokenTrustDevice .mod_trust i");if(M.hasClass("icon_false")){M.removeClass("icon_false").addClass("icon_true")}else{M.removeClass("icon_true").addClass("icon_false")}}});$(".click-row").click(function(M){M.preventDefault();M.stopPropagation();if($(window).innerWidth()>770){return}$(M.currentTarget).find(".ada-btn-area").click()});$("#btnUpdatePassword").click(j.proxy(function(M){M.stopPropagation();M.preventDefault();if(!x()){return}d("changePassword");this.resetUpdatePasswordForm();this.editPassword()},this));$("#popUpdatePassword .oldPass").on("focus click",j.proxy(function(M){$("#popUpdatePassword .grpOldPass .err_tip").hideError();$("#popUpdatePassword .grpOldPass label").removeClass("error_bg")},this)).blur(j.proxy(function(M){this.checkOldPassword()},this));var z,L;$("#popUpdatePassword .newPass, #popUpdatePassword .newPass2").on("focus click",j.proxy(function(M){M.stopImmediatePropagation();$("#popUpdatePassword .grpNewPass .err_tip").hideError();$("#popUpdatePassword .grpNewPass .txt_tip").show();$("#popUpdatePassword .grpNewPass label").removeClass("error_bg");clearTimeout(z);clearTimeout(L)},this)).blur(j.proxy(function(N){var O;var M=$(N.target);if(M.hasClass("newPass")){z=setTimeout(j.proxy(function(){this.checkNewPasswords(N)},this),300)}else{if(M.hasClass("newPass2")){L=setTimeout(j.proxy(function(){this.checkNewPasswords(N)},this),300)}}},this));var H=false;$("#popUpdatePassword .chkcode_img, #popUpdatePassword .next_capt").click(j.proxy(function(M){M.preventDefault();this.nextUpdatePasswordCaptcha()},this)).mouseover(j.proxy(function(M){H=true},this)).mouseout(j.proxy(function(M){H=false},this));var I=j.proxy(function(N){N.stopImmediatePropagation();var M=N.target;$(M.parentNode).removeClass("error_bg");$("#popUpdatePassword .capt_box .err_tip").hideError()},this);$("#popUpdatePassword .chkcode input").on("focus click",I).blur(j.proxy(function(M){if(H){return}this.checkPasswordCaptcha()},this));$("#popUpdatePassword .btnCancel").click(j.proxy(function(M){M.preventDefault();$("#popUpdatePassword").hidePopup()},this));$("#popUpdatePassword .btnOK").click(j.proxy(function(M){M.preventDefault();$("#popUpdatePassword .err_tip").hideError();$("#popUpdatePassword .error_bg").removeClass("error_bg");this.onUpdatePassword(M)},this));$("#btnUpdatePhone").click(j.proxy(function(M){M.stopPropagation();M.preventDefault();if(!x()){return}d("changePhone");MiAccountVerification({url:"/pass/auth/security/bindSafeAddress?type=PH&userId="+$(".na-num").text(),user:$(".na-num").text(),success:j.proxy(function(){this.enterNewPhone()},this),fail:function(N){p(N)}})},this));$("#popEnterNewPhone .new_capt").click(j.proxy(this.reloadUpdatePhoneCaptcha,this));$("#popEnterNewPhone .chkcode_img").click(j.proxy(this.reloadUpdatePhoneCaptcha,this));$("#popEnterNewPhone .new_phone").on("focus click",function(){var M=$("#popEnterNewPhone");var N=M.find(".binding");N.find(".err_tip:not(.empty_capt):not(.wng_capt)").hideError();N.find(".new_phone").parent().removeClass("error_bg")}).blur(j.proxy(function(P){var N=$.trim(P.target.value);if(!N){var M=$("#popEnterNewPhone");var O=M.find(".binding");O.find(".err_tip:not(.empty_capt):not(.wng_capt)").hideError();O.find(".empty_phone").showError();$(P.target).parent().addClass("error_bg")}},this));$("#popEnterNewPhone .capt_box").on("focus click",j.proxy(function(O){clearTimeout(this.phoneImageBlurTimer);var M=$("#popEnterNewPhone");var N=M.find(".binding");N.find(".empty_capt, .wng_capt").hideError();N.find(".capt_box").parent().removeClass("error_bg")},this)).blur(j.proxy(function(P){var M=$("#popEnterNewPhone");var O=M.find(".binding");var N=$.trim(P.target.value);if(!N){this.phoneImageBlurTimer=setTimeout(function(){O.find(".err_tip.empty_capt, .err_tip.wng_capt").hideError();O.find(".empty_capt").showError();$(P.target).parent().addClass("error_bg")},200)}},this));$("#popEnterNewPhone .binding .btn_commom").click(j.proxy(this.onEnterNewPhone,this));$("#popEnterNewPhone .binding .set_qst_tit").click(function(M){$("#popEnterNewPhone .binding .set_qst_list").toggle();M.stopPropagation();M.preventDefault()});$("#popEnterNewPhone .binding .set_qst_list").delegate("p","click",function(Q){var M=$(Q.target),O=M.closest(".set_qst_list").find("p"),P=M.closest("dd").find(".set_qst_tit"),R=P.find("span"),N=P.find("em");O.removeClass("chk");M.addClass("chk");R.text(M.text());N.text(M.attr("_code"));Q.preventDefault()});$("#popEnterNewPhone .binding .set_qst_list").delegate("h6","click",function(M){M.stopPropagation()});$(document.body).click(function(){$("#popEnterNewPhone .binding .set_qst_list, #popManageTokenSetMobile .binding .set_qst_list").hide()});$("#popEnterNewPhone .verify .btn_commom").click(j.proxy(this.onVerifyNewPhone,this));$("#popEnterNewPhone .verify .btn_back, #popEnterNewPhone .success .btn_commom").click(j.proxy(this.cancelUpdatePhone,this));$("#popEnterNewPhone .success .btn_commom").click(function(M){location.href="/"});var E=null;$("#popEnterNewPhone .verify .phone_capt").on("focus click",j.proxy(function(M){clearInterval(E);$("#popEnterNewPhone .verify .err_tip:not(.quota_tip)").hideError();$("#popEnterNewPhone .verify .phone_capt").parent().removeClass("error_bg")},this)).blur(j.proxy(function(N){var M=N.target;if(!$.trim(M.value)){E=setTimeout(function(){$("#popEnterNewPhone .verify .empty_capt").showError();$("#popEnterNewPhone .verify .phone_capt").parent().addClass("error_bg")},200)}},this));$("#popEnterNewPhone .verify .resend").click(function(){clearTimeout(E)});var G=h.Sender;if(this.updatePhoneSMSSender){this.updatePhoneSMSSender.stop()}var F=this.updatePhoneSMSSender=new G({smsFailureMsgBox:".sms_custom",maxQuotaToShow:2,timeStep:60*1000,type:150007,userBox:$('<input type="text">').val($(".na-num").text()),phoneBox:"#popEnterNewPhone .binding .full_new_phone",getCaptchaPostData:function(){var M=$("#popEnterNewPhone .new_phone").val();var N=$("#popEnterNewPhone .set_qst_list p.chk").attr("_code")||"";if(N==="+86"){N=""}M=N+M;return{addressType:"PH",replace:$("#btnUpdatePhone a").attr("__href").indexOf("replace=true")>-1,userId:$(".na-num").text(),passport_ph:l.get("passport_ph")||"",passportsecurity_ph:l.get("passportsecurity_ph")||"",passToken:l.get("passToken")||"",newAddress:M,contentType:150007}},phoneTipLabel:"",duplicatePhoneHTML:"",sendButton:"#popEnterNewPhone .verify .resend",captchaBox:"#popEnterNewPhone .verify .phone_capt","403Label":".fbdn_tip",quotaTextLabel:"#quotaTextLabel",quotaLabel:"#quotaLabel",captchaURL:"/pass/auth/security/sendSafeAddressTicket",quotaURL:"/pass/sms/quota",captchaVerifyLabel:"",captchaVerifyURL:"",checkBindingURL:""});F.render();$("#popEnterNewPhone .binding .btn_commom").click(function(M){M.preventDefault()});$("#btnUpdateEmail").click(j.proxy(function(M){M.stopPropagation();M.preventDefault();if(!x()){return}d("changeEmail");MiAccountVerification({url:"/pass/auth/security/bindSafeAddress?type=EM&userId="+$(".na-num").text(),user:$(".na-num").text(),success:j.proxy(function(){this.enterNewEmail()},this),fail:function(N){p(N)}})},this));$("#popEnterNewEmail .binding .new_email").on("focus click",function(M){$("#popEnterNewEmail .binding .err_tip:not(.empty_capt):not(.wng_capt)").hideError();$("#popEnterNewEmail .binding .new_email").parent().removeClass("error_bg")}).blur(j.proxy(function(P){var M=$("#popEnterNewEmail");var O=M.find(".binding");var N=$.trim(P.target.value);if(!N){O.find(".err_tip:not(.empty_capt):not(.wng_capt)").hideError();O.find(".empty_email").showError();$(P.target).parent().addClass("error_bg")}},this));$("#popEnterNewEmail .binding .capt_box").on("focus click",j.proxy(function(O){clearTimeout(this.emailImageBlurTimer);var M=$("#popEnterNewEmail");var N=M.find(".binding");N.find(".err_tip.empty_capt, .err_tip.wng_capt").hideError();N.find(".capt_box").parent().removeClass("error_bg")},this)).blur(j.proxy(function(O){var M=$("#popEnterNewEmail");var N=M.find(".binding");if(!$.trim(O.target.value)){this.emailImageBlurTimer=setTimeout(function(){N.find(".err_tip.empty_capt, .err_tip.wng_capt").hideError();N.find(".empty_capt").showError();N.find(".capt_box").parent().addClass("error_bg")},200)}},this));$("#popEnterNewEmail .binding .chkcode_img, #popEnterNewEmail .binding .chkcode_img + a").click(j.proxy(function(N){N.preventDefault();clearTimeout(this.emailImageBlurTimer);var M=$("#popEnterNewEmail .binding .chkcode_img");M.attr("src",M.attr("_src")+"&_="+q.now())},this));$("#popEnterNewEmail .binding .btn_commom").click(j.proxy(this.onEnterNewEmail,this));$("#popEnterNewEmail .verify .resend").click(j.proxy(this.onResendNewEmail,this));$("#popEnterNewEmail .verify .capt_box").on("focus click",j.proxy(function(O){clearTimeout(this.emailCaptBlurTimer);var N=$("#popEnterNewEmail");var M=N.find(".verify");M.find(".err_tip").hideError();$("#popEnterNewEmail .verify .capt_box").parent().removeClass("error_bg")},this)).blur(j.proxy(function(O){var N=$("#popEnterNewEmail");var M=N.find(".verify");if(!$.trim(O.target.value)){this.emailCaptBlurTimer=setTimeout(function(){M.find(".empty_capt").showError();M.find(".capt_box").parent().addClass("error_bg")},200)}},this));$("#popEnterNewEmail .verify .btn_back").click(function(N){N.preventDefault();var M=$("#popEnterNewEmail");M.hidePopup()});$("#popEnterNewEmail .verify .btn_commom").click(j.proxy(this.onVerifyNewEmail,this));$("#popEnterNewEmail .success .btn_commom").click(function(N){N.preventDefault();var M=$("#popEnterNewEmail");location.href="/"});var D=false;$("#btnSetMibao").click(j.proxy(function(M){M.stopPropagation();M.preventDefault();if(!x()){return}d("changeMibao");MiAccountVerification({url:"/pass/auth/security/setSafeQuestions?userId="+$(".na-num").text(),user:$(".na-num").text(),success:j.proxy(function(){if(!D){if(C){B.render();D=true;$("#popSetMibao form").bind("submit",y)}else{if(!x()){return}$.ajax({type:"GET",url:"/pass/auth/security/verifyQuestions",dataType:"text",data:{userId:$(".na-num").text(),_:+new Date},error:u,success:function(N){N=N.replace("&&&START&&&","");N=$.parseJSONSafe(N);if(N.result===0){window.mibaoData=window.pageData=N.info}B.render();D=true;$("#popSetMibao form").bind("submit",y)}})}}this.setMibao()},this),fail:function(N){p(N)}})},this));var J=$("#frmSetQuestions");var C=window.mibaoData||window.pageData;var B;B=this.setMibaoForm=new v.QuestionForm({form:J,ajax:true});var y=j.proxy(function(O){var P=$("#popAnswerMibao");var N=$("#popSetMibao select.iselect");var M=P.find(".set_mibao li p");M.each(function(R,S){var Q=$(S);Q.text(N[R].value)});$("#popSetMibao").hidePopup();this.answerMibao()},this);$("#popAnswerMibao .input_bg input").bind("focus",function(M){$(M.target).closest("li").find(".error-mes").hide()});$("#popAnswerMibao .btn_back").click(function(M){M.preventDefault();$("#popAnswerMibao").hidePopup();$("#popSetMibao").showPopup();$("#popAnswerMibao .input_bg input").val("");return false});$("#popAnswerMibao .btn_commom").click(function(O){O.preventDefault();var M=$("#popAnswerMibao .form-error-mes");M.hide();var N=false;$("#popAnswerMibao .input_bg input").each(function(R,S){var Q=$(S);var P=Q.closest("li").find(".error-mes");var T=Q.val();if(!T){P.text(o.getResource("answer_empty")).show();N=true}else{P.text("").hide()}});if(N){return}if(!x()){return}$.ajax({url:"/pass/auth/security/setSafeQuestions",type:"POST",data:{userId:$(".na-num").text(),passport_ph:l.get("passport_ph")||"",passportsecurity_ph:l.get("passportsecurity_ph")||"",passToken:l.get("passToken")||"",questions:$("#popSetMibao .form-data").val(),verifiedQuestions:(function(){var P=[];$("#popAnswerMibao .input_bg input").each(j.proxy(function(R,S){var Q=$(S);$question=Q.parent().parent().find("p");P.push('{"q":"'+v.QuestionForm.addSlashes($question.html())+'","a":"'+v.QuestionForm.addSlashes(Q.val())+'"}')},this));return"["+P.join(",")+"]"})()},dataType:"text",error:u,success:function(P){P=P.replace("&&&START&&&","");P=$.parseJSONSafe(P);if(P.result===0){M.hide();$("#popAnswerMibao").hidePopup();$("#popFinishMibao").showPopup();d("changeMibao","end")}else{switch(P.result){case 1200305:M.text(o.getResource("wrong_answer")).show();break;case 5200306:case 5200307:case 5200308:M.text(o.getResource("jsp_2014_tip23")+"("+P.result+")").show();break;default:}}}});return false});$("#popFinishMibao .btn_commom").click(function(M){M.preventDefault();location.href="/"});$("#btnManageToken").click(j.proxy(function(M){M.stopPropagation();M.preventDefault();if(!x()){return}d("enableTwoStepLogin");this.manageToken()},this));$(document.body).delegate("a[_href]","click",j.proxy(function(Q){Q.preventDefault();var P=$(Q.target);var S=$(P.attr("_href"));var O=P.attr("_target")||"self";var R=P.parents(".mod_acc_tip",true);var N=R.attr("id");var T=S.attr("id");function M(){S.find(".disten30x76 img").removeAttr("src").removeAttr("_secret").removeAttr("_reset");S.find("input[type=text]").val("");S.find(".err_tip").hideError();if(!x()){return}$.ajax({type:"get",url:"/pass/auth/security/genEnableSecret",data:{userId:$(".na-num").text(),reset:$("#btnManageToken a").attr("__href").indexOf("status")>-1},dataType:"text",error:u,success:function(U){U=U.replace("&&&START&&&","");U=$.parseJSONSafe(U);if(U.result===0){S.find(".disten30x76 img").attr("src",U.info.QRCodeUrl).attr("_secret",U.info.secret).removeAttr("_reset");if(R.attr("id")==="popManageTokenStatus"){S.find(".disten30x76 img").attr("_reset",true)}S.find(".err_tip").hideError();if(O!=="_blank"){R.hidePopup({dontAffectHash:true})}S.showPopup()}else{R.find(".sys_err").showError(U.result)}}})}switch(T){case"popManageTokenDownload":if($("#btnManageToken a").attr("__href").indexOf("status")>-1){$("#popManageTokenDownload .tip_btns").addClass("token_enabled")}else{$("#popManageTokenDownload .tip_btns").removeClass("token_enabled")}if(O!=="_blank"){R.hidePopup({dontAffectHash:true})}S.showPopup();break;case"popManageTokenSetMobile":if(!x()){return}MiAccountVerification({url:"/pass/auth/security/setBackupPhone?userId="+$(".na-num").text(),user:$(".na-num").text(),success:j.proxy(function(){if(O!=="_blank"){R.hidePopup()}S.hideError().showPopup();S.find(".error_bg").removeClass("error_bg");S.find(".err_tip").hideError()},this),fail:function(U){p(U)}});break;case"popManageTokenActivate":if(N==="popManageTokenStatus"){if(!x()){return}MiAccountVerification({url:"/pass/auth/security/enableTwoStepLogin?userId="+$(".na-num").text(),user:$(".na-num").text(),success:j.proxy(function(){M()},this),fail:function(U){p(U)}})}else{M()}break;case"popManageTokenKeys":S.find(".mi_code span").remove();if(!x()){return}$.ajax({url:"/pass/auth/security/backupOtp",dataType:"text",type:"GET",data:{userId:$(".na-num").text(),_:+new Date},error:u,success:function(W){W=W.replace("&&&START&&&","");W=$.parseJSONSafe(W);if(W.result===0){var V=W.info.codes;var U=S.find(".mi_code");$.each(V,function(X,Y){if($.trim(Y)){U.append("<span>"+Y+"</span>")}else{U.append("<span _used>"+o.getResource("jsp_2014_token_used")+"</span>")}});if(W.info.email){S.find(".sendEmail").attr("href","mailto:"+W.info.email)}if(O!=="_blank"){R.hidePopup()}S.showPopup()}}});break;case"popEnterNewEmail":if(!x()){return}MiAccountVerification({url:"/pass/auth/security/bindSafeAddress?type=email&userId="+$(".na-num").text(),user:$(".na-num").text(),success:j.proxy(function(){if(O!=="_blank"){R.hidePopup()}this.enterNewEmail()},this),fail:function(U){p(U)}});break;case"popEnterNewPhone":if(!x()){return}MiAccountVerification({url:"/pass/auth/security/bindSafeAddress?type=phone&userId="+$(".na-num").text(),user:$(".na-num").text(),success:j.proxy(function(){if(O!=="_blank"){R.hidePopup()}this.enterNewPhone()},this),fail:function(U){p(U)}});break;case"popManageTokenDownAct":if($("#btnUpdateEmail a").attr("__href").indexOf("replace=true")===-1){if(O!=="_blank"){R.hidePopup()}$("#popManageTokenBindEmail").showPopup();return}if($("#btnUpdatePhone a").attr("__href").indexOf("replace=true")===-1){if(O!=="_blank"){R.hidePopup()}$("#popManageTokenBindPhone").showPopup();return}if(O!=="_blank"){R.hidePopup()}if(!x()){return}MiAccountVerification({url:"/pass/auth/security/enableTwoStepLogin?userId="+$(".na-num").text(),user:$(".na-num").text(),success:j.proxy(function(){S.find(".err_tip").hideError();S.showPopup()},this),fail:function(U){p(U)}});break;default:S.find(".err_tip").hideError();if(O!=="_blank"){R.hidePopup()}S.showPopup()}},this));$("#popManageTokenDownload .newtab a").click(function(O){O.preventDefault();$("#popManageTokenDownload .newtab a").removeClass("now");var N=$(O.target);N.addClass("now");var M=N.index();$($("#popManageTokenDownload .tabcon").hide()[M]).show()});$("#popManageTokenActivate input[type=text]").on("focus click",function(M){$("#popManageTokenActivate .err_tip").hideError();$("#popManageTokenActivate .input_bg").removeClass("error_bg")}).blur(function(M){if(!$.trim(M.target.value)){$("#popManageTokenActivate .empty_capt").showError();$("#popManageTokenActivate .input_bg").addClass("error_bg")}});$("#popManageTokenActivate .btn_commom").click(function(N){N.preventDefault();$("#popManageTokenActivate .err_tip").hideError();$("#popManageTokenActivate .input_bg").removeClass("error_bg");var M=$.trim($("#popManageTokenActivate input[type=text]").val());if(!M){$("#popManageTokenActivate .empty_capt").showError();$("#popManageTokenActivate .input_bg").addClass("error_bg");return}if(!x()){return}$.ajax({dataType:"text",url:"/pass/auth/security/checkCode",type:"POST",data:{passport_ph:l.get("passport_ph")||"",passportsecurity_ph:l.get("passportsecurity_ph")||"",passToken:l.get("passToken")||"",userId:$(".na-num").text(),secret:$("#popManageTokenActivate .disten30x76 img").attr("_secret"),code:M},error:u,success:function(O){O=O.replace("&&&START&&&","");O=$.parseJSONSafe(O);if(O.result===0){if(!x()){return}MiAccountVerification({url:"/pass/auth/security/enableTwoStepLogin?userId="+$(".na-num").text(),user:$(".na-num").text(),success:function(){$("#popManageTokenActivate").hidePopup();$("#popManageTokenTrustDevice .mod_trust i").attr("class","icon_true");$("#popManageTokenTrustDevice").showPopup()},fail:function(P){p(P)}})}else{$("#popManageTokenActivate .err_tip").hideError();$("#popManageTokenActivate .input_bg").addClass("error_bg");switch(O.result){case 1200413:case 1200414:$("#popManageTokenActivate .wng_capt").showError(O.result);break;case 5200415:case 5000000:$("#popManageTokenActivate .sys_err").showError(O.result);break;default:}}}})});$("#popManageTokenTrustDevice .btn_commom").click(function(M){M.preventDefault();if(!x()){return}$.ajax({url:"/pass/auth/security/enableTwoStepLogin",type:"post",dataType:"text",data:{passport_ph:l.get("passport_ph")||"",passportsecurity_ph:l.get("passportsecurity_ph")||"",passToken:l.get("passToken")||"",userId:$(".na-num").text(),secret:$("#popManageTokenActivate .disten30x76 img").attr("_secret"),reset:!!$("#popManageTokenActivate .disten30x76 img").attr("_reset"),isTrustEnable:!!$("#popManageTokenTrustDevice .mod_trust .icon_true").length,code:$("#popManageTokenActivate input[type=text]").val()},error:u,success:function(N){N=N.replace("&&&START&&&","");N=$.parseJSONSafe(N);if(N.result===0){$("#popManageTokenTrustDevice").hidePopup();var O=new q.Countdown({duration:10000,onProgress:function(P){$("#popManageTokenFinish .logoutCountdown").text(Math.round(P.timeLeft/1000))},onComplete:function(){location.href="/"}});O.start();$("#popManageTokenFinish .err_tip").hideError();$("#popManageTokenFinish").showPopup();d("enableTwoStepLogin","end")}else{switch(N.result){case 5200430:$("#popManageTokenTrustDevice .wng_capt").showError(N.result);break;default:$("#popManageTokenTrustDevice .sys_err").showError(N.result)}}}})});$("#popManageTokenStatus .tip_btns .btn_disable_token").click(function(M){M.preventDefault();$("#popManageTokenStatus").hidePopup();if(!x()){return}MiAccountVerification({url:"/pass/auth/security/disableTwoStepLogin?userId="+$(".na-num").text(),user:$(".na-num").text(),success:j.proxy(function(){$("#popManageTokenStatus .sys_err").hideError();if(!x()){return}$.ajax({url:"/pass/auth/security/disableTwoStepLogin",type:"POST",dataType:"text",data:{passport_ph:l.get("passport_ph")||"",passportsecurity_ph:l.get("passportsecurity_ph")||"",passToken:l.get("passToken")||"",userId:$(".na-num").text()},error:u,success:function(N){N=N.replace("&&&START&&&","");N=$.parseJSONSafe(N);$("#popManageTokenStatus").showPopup();if(N.result===0){$("#popManageTokenStatus").hidePopup();$("#popManageTokenDisableFinish").showPopup()}else{switch(N.result){case 5200433:case 5200434:case 5200456:case 5200457:case 5200458:case 5000000:$("#popManageTokenStatus .sys_err").showError(N.result);break;default:}}}})},this),fail:function(N){$("#popManageTokenStatus").showPopup();p(N)}})});$("#popManageTokenKeys #refresh_code").click(function(N){N.preventDefault();var M=$("#popManageTokenKeys .mi_code");if(!x()){return}$.ajax({type:"POST",url:"/pass/auth/security/refreshBackupOtp",dataType:"text",data:{passport_ph:l.get("passport_ph")||"",passportsecurity_ph:l.get("passportsecurity_ph")||"",passToken:l.get("passToken")||"",userId:$(".na-num").text()},error:u,success:function(P){P=P.replace("&&&START&&&","");P=$.parseJSONSafe(P);if(P.result===0){M.find("span").remove();var O=P.info.codes;$.each(O,function(Q,R){if($.trim(R)){M.append("<span>"+R+"</span>")}else{M.append("<span _used>"+o.getResource("jsp_2014_token_used")+"</span>")}})}}})});$("#popManageTokenSetMobile .set_qst_tit").click(function(M){$("#popManageTokenSetMobile .set_qst_list").toggle();M.stopPropagation();M.preventDefault()});$("#popManageTokenSetMobile .set_qst_list").delegate("p","click",function(Q){var M=$(Q.target),O=M.closest(".set_qst_list").find("p"),P=M.closest(".fixpos").find(".set_qst_tit"),R=P.find("span"),N=P.find("em");O.removeClass("chk");M.addClass("chk");R.text(M.text());N.text(M.attr("_code"));Q.preventDefault()});$("#popManageTokenSetMobile .set_qst_list").delegate("h6","click",function(M){M.stopPropagation()});$("#popManageTokenSetMobile .backupPhoneInput").on("focus click",function(M){$("#popManageTokenSetMobile .err_tip").hideError();$("#popManageTokenSetMobile .input_bg").removeClass("error_bg")});$("#popManageTokenSetMobile .btn_commom").click(j.proxy(function(P){P.preventDefault();var Q=$("#popManageTokenSetMobile"),R=Q.find(".backupPhoneInput");var M=R.val();if(!M){Q.find(".empty_phone").showError();$("#popManageTokenSetMobile .input_bg").addClass("error_bg");return}if(!/^\d+$/.test(M)){Q.find(".wng_fmt").showError();$("#popManageTokenSetMobile .input_bg").addClass("error_bg");return}var O=$.trim(Q.find(".c_b em").text());if(O==="+86"){O=""}var N=O+M;if(!x()){return}$.ajax({type:"POST",dataType:"text",url:"/pass/auth/security/setBackupPhone",data:{passport_ph:l.get("passport_ph")||"",passportsecurity_ph:l.get("passportsecurity_ph")||"",passToken:l.get("passToken")||"",userId:$(".na-num").text(),phone:N,replace:$("#popManageTokenStatus li:first-child dd").hasClass(".has_fb_mobile")},error:u,success:j.proxy(function(S){S=S.replace("&&&START&&&","");S=$.parseJSONSafe(S);Q.find(".err_tip").hideError();Q.find(".backupPhoneInput").val("");if(S.result===0){$("#popManageTokenStatus li:first-child dd .fb_mobile span").text(N);$("#popManageTokenStatus li:first-child dd").addClass("has_fb_mobile");Q.hideError();Q.hidePopup();this.manageToken()}else{$("#popManageTokenSetMobile .input_bg").addClass("error_bg");switch(S.result){case 1200444:$("#popManageTokenSetMobile .empty_phone").showError(S.result);break;case 1200445:$("#popManageTokenSetMobile .wng_fmt").showError(S.result);break;case 1200446:$("#popManageTokenSetMobile .bad_param").showError(S.result);break;case 1200448:$("#popManageTokenSetMobile .dupl_phone").showError(S.result);break;case 1200449:$("#popManageTokenSetMobile .set_fail").showError(S.result);break;case 5200451:case 5200450:case 5200447:case 5000000:$("#popManageTokenSetMobile .sys_err").showError(S.result);break;default:$("#popManageTokenSetMobile .set_fail").showError(S.result)}}},this)})},this));$("#popManageTokenStatus .delBackupPhone").click(function(M){M.preventDefault();if(!x()){return}MiAccountVerification({url:"/pass/auth/security/deleteBackupPhone?userId="+$(".na-num").text(),user:$(".na-num").text(),success:j.proxy(function(){$("#popManageTokenStatus .sys_err").hideError();if(!x()){return}$.ajax({url:"/pass/auth/security/deleteBackupPhone",dataType:"text",type:"POST",data:{passport_ph:l.get("passport_ph")||"",passportsecurity_ph:l.get("passportsecurity_ph")||"",passToken:l.get("passToken")||"",userId:$(".na-num").text()},error:u,success:function(N){N=N.replace("&&&START&&&","");N=$.parseJSONSafe(N);if(N.result===0){$("#popManageTokenStatus li:first-child dd .fb_mobile span").text("");$("#popManageTokenStatus li:first-child dd").removeClass("has_fb_mobile")}else{switch(N.result){case 5200452:case 5200453:case 5200455:case 5000000:$("#popManageTokenStatus .sys_err").showError(N.result);break;case 1200454:$("#popManageTokenStatus .backup_phone_not_exists").showError(N.result);break;default:}}}})},this),fail:function(N){p(N)}})});$("#popManageTokenKeys .sendEmail").click(function(O){var N=[];$("#popManageTokenKeys .mi_code span:not([_used])").each(function(Q,R){N.push($.trim($(R).text()))});var P="?subject="+encodeURIComponent(o.getResource("jsp_2014_my_backup_keys"))+"&body="+N.join(" \r\n");var M=O.target.href;if(M.indexOf("subject=")===-1){M+=P}else{M=M.replace(/\?.*$/g,P)}O.target.href=M});$("#popUpdatePassword .oldPass, #popUpdatePassword .newPass, #popUpdatePassword .newPass2, #popUpdatePassword .capt_box").keypress(function(M){if(M.keyCode===13){M.preventDefault();$("#popUpdatePassword .btnOK").click()}});$("#popEnterNewEmail .binding .new_email, #popEnterNewEmail .binding .capt_box").keypress(function(M){if(M.keyCode===13){M.preventDefault();$("#popEnterNewEmail .binding .btn_commom").click()}});$("#popEnterNewEmail .verify .capt_box").keypress(function(M){if(M.keyCode===13){M.preventDefault();$("#popEnterNewEmail .verify .btn_commom").click()}});$("#popEnterNewPhone .binding .new_phone, #popEnterNewPhone .binding .capt_box").keypress(function(M){if(M.keyCode===13){M.preventDefault();$("#popEnterNewPhone .binding .btn_commom").click()}});$("#popEnterNewPhone .verify .phone_capt").keypress(function(M){if(M.keyCode===13){M.preventDefault();$("#popEnterNewPhone .verify .btn_commom").click()}});$("#printKeys").click(function(M){M.preventDefault();window.print()});var K=$("#popManageTokenStatus");var A=$("#popManageTokenKeys");$(window).resize(q.debounce(function(){K.positionPopup();A.positionPopup()}));$("#popVeriFailed .btn_back").click(function(N){N.preventDefault();var M=$(N.target);var O=M.closest(".mod_acc_tip");O.hidePopup()})},resetUpdatePasswordForm:function(y){y=y||{};var z=$("#popUpdatePassword");z.find(".error_bg").removeClass("error_bg");z.find(".grpOldPass .err_tip, .capt_box .err_tip").hideError();if(!y.keepInputs){z.find("input[type=text], input[type=password]").val("")}},nextUpdatePasswordCaptcha:function(A){var z=$("#popUpdatePassword .chkcode_img");var y=z.attr("src")||"/pass/getCode?icodeType=login&_t=0";y=y.replace(/_t\=\d*/g,"_t="+(+new Date));z.attr("src",y)},onUpdatePasswordSuccess:function(){$("#popUpdatePassword").hidePopup();$("#popUpdatePasswordSuccess").showPopup();var y=new q.Countdown({duration:10000,onProgress:function(z){$("#popUpdatePasswordSuccess .logoutCountdown").text(Math.round(z.timeLeft/1000))},onComplete:function(){location.href="/"}});y.start();d("changePassword","end")},onOldPasswordWrong:function(y){$("#popUpdatePassword .grpOldPass .wng_pwd").showError(y);$("#popUpdatePassword .oldPass").parent().addClass("error_bg");$("#popUpdatePassword .capt_box .chkcode input").val("")},onUpdatePasswordCaptchaWrong:function(y){$("#popUpdatePassword .capt_box .wng_capt").showError(y);$("#popUpdatePassword .capt_box .chkcode").addClass("error_bg");$("#popUpdatePassword .capt_box .chkcode input").val("");$("#popUpdatePassword .grpOldPass label").removeClass("error_bg");$("#popUpdatePassword .grpOldPass .wng_pwd").hideError()},updatePasswordAttempts:0,MAX_UPDATE_CAPTLESS_ATTEMPTS:3,onUpdatePasswordSystemError:function(y){$("#popUpdatePassword .sys_err").showError(y)},onUpdatePasswordTooMuchError:function(y){$("#popUpdatePassword .too_much").showError(y)},onUpdatePasswordEmailDisallowedError:function(y){$("#popUpdatePassword .eq_email").showError(y)},onUpdatePassword:function(y){if(!this.checkOldPassword()||!this.checkNewPasswords(y)){return false}var z=$("#popUpdatePassword");if(z.find(".oldPass").val()===z.find(".newPass").val()){z.find(".same_pwd").showError();z.find(".grpNewPass label").addClass("error_bg");return false}if($("#popUpdatePassword .capt_box").css("display")!=="none"){if(!this.checkPasswordCaptcha()){return false}}this.resetUpdatePasswordForm({keepInputs:true});if(!x()){return}$.ajax({url:"/pass/auth/security/changePassword",type:"POST",dataType:"text",data:{passport_ph:l.get("passport_ph")||"",passportsecurity_ph:l.get("passportsecurity_ph")||"",passToken:l.get("passToken")||"",userId:$(".na-num").text(),oldPassword:$("#popUpdatePassword .oldPass").val(),password:$("#popUpdatePassword .newPass").val(),icode:$.trim($("#popUpdatePassword .chkcode input").val())},error:u,success:j.proxy(function(B){B=B.replace("&&&START&&&","");B=$.parseJSONSafe(B);var A=B.result;if(A===0){this.onUpdatePasswordSuccess()}else{switch(A){case 110021001:case 110041001:case 1200102:case 1200106:this.onOldPasswordWrong(B.result);break;case 1200107:case 1200105:this.onUpdatePasswordCaptchaWrong(B.result);break;case 550065002:case 550001008:case 550025000:case 550065000:case 5200107:case 5200108:case 5200109:case 5200111:case 5000000:this.onUpdatePasswordSystemError(B.result);break;case 4200104:this.onUpdatePasswordTooMuchError(B.result);break;case 1200110:this.onUpdatePasswordEmailDisallowedError(B.result);break;default:}if(B.info&&B.info.captchaUrl){this.requirePasswordCaptcha(B.info.captchaUrl)}}},this)});return true},checkOldPassword:function(){var y=$("#popUpdatePassword .oldPass").val();if(!y){$("#popUpdatePassword .grpOldPass .empty_pwd").showError();$("#popUpdatePassword .grpOldPass label").addClass("error_bg")}else{$("#popUpdatePassword .grpOldPass .empty_pwd").hideError();$("#popUpdatePassword .grpOldPass label").removeClass("error_bg")}return !!y},checkNewPasswords:function(E){var D=$("#popUpdatePassword .newPass").val(),y=$("#popUpdatePassword .newPass2").val();if(!D){if(!$(E.target).hasClass(".newPass")){$("#popUpdatePassword .grpNewPass .empty_pwd").showError();$("#popUpdatePassword .newPass").parent().addClass("error_bg")}return false}else{$("#popUpdatePassword .grpNewPass .empty_pwd").hideError();$("#popUpdatePassword .newPass").parent().removeClass("error_bg")}if(!y){$("#popUpdatePassword .grpNewPass .empty_pwd2").showError();$("#popUpdatePassword .newPass2").parent().addClass("error_bg");return false}else{$("#popUpdatePassword .grpNewPass .empty_pwd2").hideError();$("#popUpdatePassword .newPass2").parent().removeClass("error_bg")}if(D!==y){$("#popUpdatePassword .grpNewPass .pwd_mismatch").showError();$("#popUpdatePassword .newPass2").parent().addClass("error_bg");return false}else{$("#popUpdatePassword .grpNewPass .pwd_mismatch").hideError();$("#popUpdatePassword .newPass2").parent().removeClass("error_bg")}var A=/\d/g,z=/[a-zA-Z]/g,C=/[^0-9a-zA-Z]/g;var B=0+A.test(D)+z.test(D)+C.test(D);if(B<2||D.length<8||D.length>16){$("#popUpdatePassword .grpNewPass .pwd_fmt").showError();$("#popUpdatePassword .grpNewPass .txt_tip").hide();$("#popUpdatePassword .newPass").parent().addClass("error_bg");$("#popUpdatePassword .newPass2").parent().addClass("error_bg");return false}else{$("#popUpdatePassword .grpNewPass .pwd_fmt").hideError();$("#popUpdatePassword .grpNewPass .txt_tip").show();$("#popUpdatePassword .newPass").parent().removeClass("error_bg");$("#popUpdatePassword .newPass2").parent().removeClass("error_bg")}return true},checkPasswordCaptcha:function(){var y=$.trim($("#popUpdatePassword .chkcode input").val());if(!y){$("#popUpdatePassword .capt_box .empty_capt").showError();$("#popUpdatePassword .capt_box .chkcode").addClass("error_bg");return false}else{$("#popUpdatePassword .capt_box .empty_capt").hideError();$("#popUpdatePassword .capt_box .chkcode").removeClass("error_bg")}return true},requirePasswordCaptcha:function(z){z=z||"/pass/getCode?icodeType=login";z+="&_t="+(+new Date);$("#popUpdatePassword .capt_box .chkcode_img").attr("src",z);$("#popUpdatePassword .capt_box").show();var y=$("#popUpdatePassword");y.css("margin-top",-Math.max(Math.round(y.prop("offsetHeight")/2))+"px")},checkNewPhone:j.proxy(function(C){var z=$("#popEnterNewPhone");var B=z.find(".binding");var y=B.find(".new_phone").val();var A=$("#popEnterNewPhone .set_qst_list p.chk").attr("_code")||"";if(A==="+86"){A=""}y=A+y;if(!$.trim($("#popEnterNewPhone .capt_box").val())){return}if(!x()){return}$.ajax({url:"/pass/auth/security/checkSafeAddressParams",type:"POST",data:{passport_ph:l.get("passport_ph")||"",passportsecurity_ph:l.get("passportsecurity_ph")||"",passToken:l.get("passToken")||"",addressType:"PH",userId:$(".na-num").text(),newAddress:y,icode:$.trim(B.find(".capt_box").val()),replace:$("#btnUpdatePhone a").attr("__href").indexOf("replace=true")>-1},dataType:"text",error:u,success:function(D){D=D.replace("&&&START&&&","");D=$.parseJSONSafe(D);if(D.result===0){if(C){C()}}else{B.find(".chkcode_img").click();B.find(".capt_box").val("");switch(D.result){case 1200216:B.find(".wng_fmt").showError(D.result);B.find(".new_phone").parent().addClass("error_bg");break;case 1200205:B.find(".phone_bound").showError(D.result);B.find(".new_phone").parent().addClass("error_bg");break;case 1200207:B.find(".phone_bound_elsewhere").showError(D.result);B.find(".new_phone").parent().addClass("error_bg");break;case 5200203:case 5200204:case 5200206:case 5200218:case 5000000:B.find(".sys_err").showError(D.result);break;case 1200201:B.find(".wng_capt").showError(D.result);B.find(".capt_box").parent().addClass("error_bg");break;case 1200202:B.find(".bad_param").showError(D.result);break;case 1200217:B.find(".dupl_phone").showError(D.result);B.find(".new_phone").parent().addClass("error_bg");break;default:}}}})},this),checkNewEmail:function(C){var A=this;var y=$("#popEnterNewEmail");var B=y.find(".binding");var z=B.find(".new_email").val();if(!z){B.find(".empty_email").showError();return false}if(!/^[\w.\-]+@(?:[a-z0-9]+(?:-[a-z0-9]+)*\.)+[a-z]{2,6}$/.test(z)){B.find(".wng_fmt").showError();return false}if(!x()){return}$.ajax({url:"/pass/auth/security/checkSafeAddressParams",type:"POST",data:{passport_ph:l.get("passport_ph")||"",passportsecurity_ph:l.get("passportsecurity_ph")||"",passToken:l.get("passToken")||"",addressType:"EM",userId:$(".na-num").text(),newAddress:z,icode:$.trim(B.find(".capt_box").val()),replace:$("#btnUpdateEmail a").attr("__href").indexOf("replace=true")>-1},dataType:"text",error:u,success:j.proxy(function(E){E=E.replace("&&&START&&&","");E=$.parseJSONSafe(E);if(E.result===0){if(C){C()}}else{var D=$("#popEnterNewEmail .binding .chkcode_img");D.attr("src",D.attr("src")+"&_="+q.now());$("#popEnterNewEmail .binding .capt_box").val("").parent().addClass("error_bg");clearTimeout(A.emailImageBlurTimer);switch(E.result){case 1200216:B.find(".wng_fmt").showError(E.result);break;case 1200205:B.find(".email_bound").showError(E.result);break;case 1200207:B.find(".email_bound_elsewhere").showError(E.result);break;case 5200203:case 5200204:case 5200206:case 5000000:B.find(".sys_err").showError(E.result);break;case 1200201:B.find(".wng_capt").showError(E.result);break;case 1200202:B.find(".bad_param").showError(E.result);break;default:}}},this)})},onEnterNewPhone:function(C){var z=$("#popEnterNewPhone");var B=z.find(".binding");B.find(".err_tip").hideError();var y=B.find(".new_phone").val();if(!y){B.find(".empty_phone").showError();B.find(".new_phone").parent().addClass("error_bg");if(C){C.preventDefault()}return false}if(!/^\d+$/.test(y)){B.find(".wng_fmt").showError();B.find(".new_phone").parent().addClass("error_bg");if(C){C.preventDefault()}return false}var A=$.trim(z.find(".capt_box").val());if(!A){B.find(".empty_capt").showError();z.find(".capt_box").parent().addClass("error_bg");if(C){C.preventDefault()}return false}this.checkNewPhone(j.proxy(function(){var F=$("#popEnterNewPhone .binding .set_qst_tit em").text();if(F==="+86"){F=""}var E=F;if(!E){E="+86"}var D=z.find(".verify");D.find(".disten30x103 h6 em").text(" "+E+" "+y+" ");B.hide();D.show();$(z.find(".tab_opt span").removeClass("now")[1]).addClass("now");$(z.find(".tabline i").removeClass("now")[1]).addClass("now");$("#popEnterNewPhone .binding .full_new_phone").val(F+y);var G=this.updatePhoneSMSSender;if(typeof this.updatePhoneSMSSender.quota==="number"){$("#popEnterNewPhone .verify .resend").click()}else{if(!x()){return}$.ajax({url:G.quotaURL,dataType:"text",type:"POST",data:G.getQuotaPostData?G.getQuotaPostData():{address:G.$phoneBox.val(),contentType:G.type,userId:G.type?G.$userBox.val():-1},error:u,success:j.proxy(function(I){I=G.constructor.toJSON(I);var H=+I.info||0;G.quota=H;G.showQuota(G.quota);if(G.quota<=0){if(G.quotaURL){if(G.countdown){G.countdown.stop()}G.disabled=true;G.disableSendButton()}}else{$("#popEnterNewPhone .verify .resend").click()}},G)})}},this));if(C){C.preventDefault()}return false},onVerifyNewEmail:function(D){if(D){D.preventDefault()}var C=this;var z=$("#popEnterNewEmail");var y=z.find(".verify");var B=z.find(".success");var A=$.trim(y.find(".capt_box").val());if(!A){y.find(".empty_capt").showError();y.find(".capt_box").parent().addClass("error_bg");return}if(!x()){return}$.ajax({type:"post",dataType:"text",url:"/pass/auth/security/bindSafeAddress",data:{vkey:$.trim(y.find(".capt_box").val()),userId:$(".na-num").text(),newAddress:$("#popEnterNewEmail .binding .new_email").val(),passport_ph:l.get("passport_ph")||"",passportsecurity_ph:l.get("passportsecurity_ph")||"",passToken:l.get("passToken")||"",addressType:"EM",replace:$("#btnUpdateEmail a").attr("__href").indexOf("replace=true")>-1},error:u,success:function(E){E=E.replace("&&&START&&&","");E=$.parseJSONSafe(E);if(E.result===0){y.find(".capt_box").parent().removeClass("error_bg");$(z.find(".tab_opt span").removeClass("now")[2]).addClass("now");$(z.find(".tabline i").removeClass("now")[2]).addClass("now");y.hide();B.show();d("changeEmail","end")}else{y.find(".err_tip").hideError();y.find(".capt_box").parent().addClass("error_bg");switch(E.result){case 1200212:y.find(".wng_capt").showError(E.result);break;case 5200213:case 5200214:case 5000000:y.find(".sys_err").showError(E.result);break;default:}}}})},onVerifyNewPhone:function(y){if(y){y.preventDefault()}if(!$.trim($("#popEnterNewPhone .verify .phone_capt").val())){$("#popEnterNewPhone .verify .phone_capt").parent().addClass("error_bg");$("#popEnterNewPhone .verify .empty_capt").showError();return}if(!x()){return}$.ajax({type:"POST",dataType:"text",url:"/pass/auth/security/bindSafeAddress",data:{userId:$(".na-num").text(),vkey:$.trim($("#popEnterNewPhone .verify .phone_capt").val()),replace:$("#btnUpdatePhone a").attr("__href").indexOf("replace=true")>-1,passport_ph:l.get("passport_ph")||"",passportsecurity_ph:l.get("passportsecurity_ph")||"",passToken:l.get("passToken")||"",newAddress:$("#popEnterNewPhone .binding .full_new_phone").val()},error:u,success:function(C){C=C.replace("&&&START&&&","");C=$.parseJSONSafe(C);var A=$("#popEnterNewPhone");var z=A.find(".verify");var B=A.find(".success");if(C.result===0){$(A.find(".tab_opt span").removeClass("now")[2]).addClass("now");$(A.find(".tabline i").removeClass("now")[2]).addClass("now");z.hide();B.show();d("changePhone","end")}else{A.find(".verify .err_tip").hideError();$("#popEnterNewPhone .verify .phone_capt").parent().addClass("error_bg");switch(C.result){case 4200219:A.find(".verify .phone_used").showError(C.result);break;case 1200212:A.find(".verify .wng_capt").showError(C.result);break;default:}}}});return false},reloadUpdatePhoneCaptcha:function(z){clearTimeout(this.phoneImageBlurTimer);var y=$("#popEnterNewPhone .chkcode_img");var A=y.attr("src");if(A.indexOf("?")===-1){A+="?"}else{A+="&"}A+="_="+(+new Date);y.attr("src",A);if(z){z.preventDefault()}return false},cancelUpdatePhone:function(y){$("#popEnterNewPhone").hidePopup();if(y){y.preventDefault()}return false},showTip:function(y){},hideTip:function(y){},editPassword:function(){if(!x()){return}$.ajax({url:"/pass/auth/security/changePassword",type:"get",dataType:"text",data:{userId:$(".na-num").text()},error:u,success:j.proxy(function(y){y=y.replace("&&&START&&&","");y=$.parseJSONSafe(y);if(y.result===0){if(y.info.captchaUrl){this.requirePasswordCaptcha(y.info.captchaUrl)}else{$("#popUpdatePassword .capt_box").hide()}var z=$("#popUpdatePassword");z.showPopup().find(".err_tip").hide();z.find(".grpNewPass .txt_tip").show()}},this)})},updatePassword:function(){},editEmail:function(){},updateEmail:function(){},enterNewPhone:function(){var z=$("#popEnterNewPhone");$(z.find(".tab_opt span").removeClass("now")[0]).addClass("now");$(z.find(".tabline i").removeClass("now")[0]).addClass("now");z.find(".binding").show();z.find(".verify").hide();z.find(".success").hide();z.find("input").val("");z.find(".err_tip").hideError();var y=z.find(".chkcode_img");y.attr("src",y.attr("_src")+"&_="+q.now());z.showPopup()},enterNewEmail:function(){var z=$("#popEnterNewEmail");$(z.find(".tab_opt span").removeClass("now")[0]).addClass("now");$(z.find(".tabline i").removeClass("now")[0]).addClass("now");z.find(".binding").show();z.find(".verify").hide();z.find(".success").hide();z.find("input").val("");z.find(".err_tip").hideError();var y=z.find(".chkcode_img");y.attr("src",y.attr("_src")+"&_="+q.now());z.showPopup()},setMibao:function(){var A=$("#popSetMibao");A.find(".error-mes").html("").hide();var y=$("#frmSetQuestions ul > li");y.each(function(C,D){var B=$(D);var E=B.find('dd[_type^="-"]');if(!E.length){E=B.find("dd.def-opt")}E.click()});$("#frmSetQuestions").trigger("reset");A.showPopup();var z=$("#popAnswerMibao");z.find("li label input").val("");z.find("li > p").html("")},answerMibao:function(z){var A=$("#popAnswerMibao");A.find(".error-mes").text("").hide();if(z&&z.list&&z.list.length){var y=A.find(".set_mibao li p");y.each(function(B,C){$(C).text(z.list[B].q)})}A.showPopup()},manageToken:function(){var A;var y=$("#btnManageToken a");var z=y.attr("__href");if(z.indexOf("status")>-1){A=$("#popManageTokenStatus")}else{if(z.indexOf("explain")>-1){A=$("#popManageTokenHome")}}if(A){if(A.attr("id")==="popManageTokenStatus"){if(!x()){return}$.ajax({url:"/pass/auth/security/twoStepLoginStatus",type:"GET",dataType:"text",data:{userId:$(".na-num").text(),_:+new Date},error:u,success:function(B){B=B.replace("&&&START&&&","");B=$.parseJSONSafe(B);var C=B.info.hasBackupPhone;if(C){A.find("li:first-child dd .fb_mobile span").text(B.info.backupPhone);A.find("li:first-child dd").addClass("has_fb_mobile")}else{A.find("li:first-child dd").removeClass("has_fb_mobile")}A.find(".err_tip").hideError();A.showPopup()}})}else{A.find(".err_tip").hideError();A.showPopup()}}},confirmMibao:function(){var y=$("#popAnswerMibao");y.showPopup()},emailSendTimes:0,emailCaptBlurTimer:null,onResendNewEmail:function(A){clearInterval(this.emailCaptBlurTimer);var B=$("#popEnterNewEmail");var z=B.find(".resend");var y=B.find(".verify");if(z.hasClass("noSend")){return}z.addClass("noSend");if(!x()){return}$.ajax({type:"POST",url:"/pass/auth/security/sendSafeAddressTicket",data:{passport_ph:l.get("passport_ph")||"",passportsecurity_ph:l.get("passportsecurity_ph")||"",passToken:l.get("passToken")||"",userId:$(".na-num").text(),newAddress:B.find(".new_email").val(),addressType:"EM",replace:$("#btnUpdateEmail a").attr("__href").indexOf("replace=true")>-1},dataType:"text",error:u,success:j.proxy(function(E){E=E.replace("&&&START&&&","");E=$.parseJSONSafe(E);if(E.result===0){var D=60000+60000*this.emailSendTimes++,C=100;var H=new Date;var F=z.attr("title");var G=setInterval(function(){var I=new Date;var K=I-H;var J=D/1000-Math.round(K/1000);if(J>0){z.text(F+"("+J+")")}else{z.removeClass("noSend").text(F);clearInterval(G)}},C)}else{y.find(".err_tip").hideError();switch(E.result){case 5200209:case 5000000:y.find(".err_tip.sys_err").showError(E.result);break;case 1200210:y.find(".err_tip.wng_capt").showError(E.result);break;default:}}},this)})},onEnterNewEmail:function(C){var y=$("#popEnterNewEmail");var B=y.find(".binding");B.find(".err_tip").hideError();var z=B.find(".new_email").val();if(!z){B.find(".empty_email").showError();B.find(".new_email").parent().addClass("error_bg");if(C){C.preventDefault()}return false}if(!/^[\w.\-]+@(?:[a-z0-9]+(?:-[a-z0-9]+)*\.)+[a-z]{2,6}$/.test(z)){B.find(".wng_fmt").showError();B.find(".new_email").parent().addClass("error_bg");if(C){C.preventDefault()}return false}var A=$.trim(y.find(".capt_box").val());if(!A){B.find(".empty_capt").showError();y.find(".capt_box").parent().addClass("error_bg");if(C){C.preventDefault()}return false}this.checkNewEmail(function(){var D=y.find(".verify");D.find(".disten30x103 h6 em").text(" "+z+" ");B.hide();D.show();$(y.find(".tab_opt span").removeClass("now")[1]).addClass("now");$(y.find(".tabline i").removeClass("now")[1]).addClass("now");$("#popEnterNewEmail .verify .resend").click()});if(C){C.preventDefault()}return false},updatePhone:function(){},editMibaoQuestions:function(){},updateMibaoQuestions:function(){},enableToken:function(){},disableToken:function(){}});var t=j.$class({constructor:function(){},uploadingPhoto:false,render:function(){$(document.body).delegate(".mod_acc_tip .btn_mod_close, .btn_back","click",j.proxy(function(ae){ae.preventDefault();var ac=$(ae.target),ag=ae.target.id,af=ac.closest(".mod_acc_tip"),ad=af.attr("id");switch(ag){case"reuploadPhoto":$("#photoUploader")[0].reset();$($(".layeruploadface .mod_tip_bd").hide()[0]).showPopup();$(".uploadimgs img").removeAttr("style").removeAttr("src");break;case"abortUpload":this.uploadingPhoto=false;$(ae.target).closest(".mod_acc_tip").hidePopup();$(".naImgLink a").click();$("#uploadPhoto").attr("src","about:blank");$(".uploadimgs img").removeAttr("style").removeAttr("src");break;default:$(ae.target).closest(".mod_acc_tip").hidePopup()}},this));$(".main_l").click(function(ac){ac.preventDefault();ac.stopPropagation();if($(window).innerWidth()>770){return}$(ac.currentTarget).find(".naImgLink a").click()});$(".titsbirth").bind("click",function(ac){ac.stopPropagation();$(ac.target).closest("li").find(".tits_list").toggle()});$(document.body).click(function(ac){$(".tits_list").hide()});$(document.body).delegate(".tits_list p","click",function(af){var ac=$(af.target);var ad=ac.closest("li");var ae=ac.attr("value");if(ad.hasClass("biry")){T(ae)}else{if(ad.hasClass("birm")){K(ae)}else{D(ae)}}});$(".infosex span").click(function(ae){var ac=$(ae.target);var ad=ac.closest(".infosex");ad.find("span").removeClass("now");ac.closest("span",true).addClass("now")});function H(ac){if(ac===""){return}$(".infosex span").removeClass("now");if(isNaN(ac)){$(".infosex em:contains("+ac+")").closest("span").addClass("now")}else{$($(".infosex span")[ac]).addClass("now")}}function P(ac){ac=+ac;return(ac%100!==0&&ac%4===0)||(ac%100===0&&ac%400===0)}function G(ae,af,ad){ae=parseInt(ae,10);af=parseInt(af,10);ad=parseInt(ad,10);var ac=P(ae);var ag=J.concat([]);if(ac){ag[2]=29}if(ad<=ag[af]){return true}else{return false}}var J=[0,31,28,31,30,31,30,31,31,30,31,30,31];var C=new Date,F=C.getFullYear(),B=C.getMonth()+1,O=C.getDate();function T(ae){if(!ae){$(".biry .birthcon").text(o.getResource("jsp_2014_select"));return}$(".biry .birthcon").text(ae);if(ae==F){$(".birm .tits_list p").each(function(ag,ah){var ai=parseInt(ah.getAttribute("value"),10);if(ai<=B){$(ah).show()}else{$(ah).hide()}})}else{$(".birm .tits_list p").show()}var ad=$(".biry .birthcon").text(),af=$(".birm .birthcon").text(),ac=$(".bird .birthcon").text();if(isNaN(ad)||isNaN(af)||isNaN(ac)){return}if(!G(ad,af,ac)){$(".bird .birthcon").text(o.getResource("jsp_2014_select"))}K(af)}function K(ae){if(!ae){$(".birm .birthcon").text(o.getResource("jsp_2014_select"));return}$(".birm .birthcon").text(ae);ae=parseInt(ae,10);var ag=J[ae];if(P($(".biry .birthcon").text())&&ae===2){ag=29}$(".bird .tits_list p").each(function(ah,ai){if(ah<ag){$(ai).show()}else{$(ai).hide()}});if($(".biry .birthcon").text()==F&&parseInt($(".birm .birthcon").text())===B){$(".bird .tits_list p").each(function(ai,aj){var ah=parseInt(aj.getAttribute("value"),10);if(ah<=O){$(aj).show()}else{$(aj).hide()}})}else{}var ad=$(".biry .birthcon").text(),af=$(".birm .birthcon").text(),ac=$(".bird .birthcon").text();if(isNaN(ad)||isNaN(af)||isNaN(ac)){return}if(!G(ad,af,ac)){$(".bird .birthcon").text(o.getResource("jsp_2014_select"))}else{D(ac)}}function D(ac){if(!ac){$(".bird .birthcon").text(o.getResource("jsp_2014_select"));return}$(".bird .birthcon").text(ac)}$("#popSwitchRegion .country-container li").click(function(ad){var ag=$(ad.target).closest("li");var af=ag.find("span");var ac=$.trim(af.attr("_brief")),ae=$.trim(af.text());$("#popSwitchRegion .listtit tt").attr("_code",ac).text(ae)});$("#continueSwitch").click(function(ad){ad.preventDefault();var ac=$("#popSwitchRegion > .mod_tip_bd");$(ac[0]).hide();$(ac[1]).show()});$(document.body).click(function(ac){$("#popSwitchRegion .country-container").hide()});$("#popSwitchRegion .listtit").click(function(ac){ac.stopPropagation();$("#popSwitchRegion .country-container").toggle()});$("#doRegionSwitch").click(function(ac){ac.preventDefault();if(!x()){return}$("#popSwitchRegion .err_tip").hideError();if(!$("#popSwitchRegion .listtit tt").attr("_code")){$("#popSwitchRegion .empty_region").showError();return}if(!x()){return}$.ajax({url:"/pass/auth/profile/userRegion",type:"POST",dataType:"text",data:{userId:$(".na-num").text(),region:$("#popSwitchRegion .listtit tt").attr("_code"),passport_ph:l.get("passport_ph")||"",passportsecurity_ph:l.get("passportsecurity_ph")||"",passToken:l.get("passToken")||""},error:u,success:function(ad){ad=ad.replace("&&&START&&&","");ad=$.parseJSONSafe(ad);if(ad.result===0){location.href=location.href}else{switch(ad.result){case 5200526:case 5200527:$("#popSwitchRegion .sys_err").showError(ad.result);break;case 1200525:$("#popSwitchRegion .bad_param").showError(ad.result);break;default:$("#popSwitchRegion .sys_err").showError(ad.result)}}}})});$("#switchRegion").click(function(ag){ag.preventDefault();if(!x()){return}var ae=$("#popSwitchRegion > .mod_tip_bd");$("#popSwitchRegion .err_tip").hideError();$(ae[0]).show();$(ae[1]).hide();var af=$("#region");var ac=af.attr("_code")||"";var ai=$('#popSwitchRegion .country-container li span[_brief="'+ac+'"]');if(ai.length){var ad=$.trim(ai.attr("_brief")),ah=$.trim(ai.text());$("#popSwitchRegion .listtit tt").attr("_code",ad).text(ah)}$("#popSwitchRegion").showPopup()});(function(){var ad=$("#region");var ac=ad.attr("_code")||"";var af=$('#popSwitchRegion .country-container li span[_brief="'+ac+'"]');if(af.length){var ae=$.trim(af.text());ad.text(ae)}})();$("#editInfo, #editInfoWap").click(function(ai){ai.preventDefault();if(!x()){return}var ac=$(".layereditinfo");ac.find(".err_tip").hideError();var ad=$(".uinfo");var af=$.trim(ad.find(".lblnickname .value").text());if(ad.find(".lblnickname .value").attr("_empty")!==undefined){af=""}$("input[name=nickname]").val(af);var am=$.trim(ad.find(".lblbirthday .value").text());if(ad.find(".lblbirthday .value").attr("_empty")!==undefined){am=""}if(/\d+\/\d+\/\d+/.test(am)){var ak=am.split("/");ak.reverse();am=ak.join("-")}var ag=am.split("-"),aj=ag[0],ah=ag[1],ae=ag[2];T(aj);K(ah);D(ae);var al=$.trim(ad.find(".lblgender .value").text());if(ad.find(".lblgender .value").attr("_empty")!==undefined){al=""}H(al);ac.showPopup()});$(".layereditinfo .nickname").on("focus click",function(ac){$(".layereditinfo .err_tip").hideError()});function A(ac){ac=""+ac;if(ac.length===1){ac="0"+ac}return ac}$(".layereditinfo .btn_commom").click(function(ah){ah.preventDefault();if(!x()){return}var ac=$.trim($(".layereditinfo .nickname").val());var af="";var ae=parseInt($(".layereditinfo .biry .birthcon").text(),10),ag=parseInt($(".layereditinfo .birm .birthcon").text(),10),ad=parseInt($(".layereditinfo .bird .birthcon").text(),10);if(!ae||!ag||!ad){af=""}else{af=[ae,A(ag),A(ad)].join("-")}if(!ac){$(".layereditinfo .empty_name").showError();return}if(ac.length<2||ac.length>20){$(".layereditinfo .bad_nickname").showError();return}if(!x()){return}$.ajax({type:"POST",dataType:"text",url:"/pass/auth/profile/userProfile",data:{nickname:ac,birthday:af,gender:$(".layereditinfo .infosex .now").attr("value")||"",userId:$(".na-num").text(),passport_ph:l.get("passport_ph")||"",passportsecurity_ph:l.get("passportsecurity_ph")||"",passToken:l.get("passToken")||""},error:u,success:function(ai){ai=ai.replace("&&&START&&&","");ai=$.parseJSONSafe(ai);if(ai.result===0){$(".layereditinfo").hidePopup();location.reload(true)}else{$(".layereditinfo .err_tip").hideError();switch(ai.result){case 1200503:$(".layereditinfo .empty_param").showError(ai.result);break;case 1200504:$(".layereditinfo .bad_nickname").showError(ai.result);break;case 1200505:$(".layereditinfo .bad_birthday").showError(ai.result);break;case 1200506:$(".layereditinfo .bad_gender").showError(ai.result);break;case 1200507:$(".layereditinfo .bad_param").showError(ai.result);break;case 1200508:case 5200509:case 5200510:case 5000000:$(".layereditinfo .sys_err").showError(ai.result);break;default:}}}})});$(".uplodefile").change(j.proxy(function(aj){if(!x()){return}var ah=aj.target.files;if(ah&&ah.length){var ae=ah[0];if(ae.size>1<<21){$(".layeruploadface .file_too_large").showError();return}}var ad=aj.target.value,ag=aj.target.form,ac=$(ag);$(".layeruploadface").find(".err_tip").hide();if(ad){var ai=ad.lastIndexOf(".");if(ai!==-1){var af=ad.substring(ai+1).toLowerCase();if(af!=="png"&&af!=="jpg"){$(".layeruploadface .wng_fmt").showError();return}}}$(".layeruploadface .err_tip").hideError();this.uploadingPhoto=true;if(!x()){return}$.ajax({type:"POST",url:"/pass/auth/profile/requestUpload",dataType:"text",data:{userId:$(".na-num").text(),passport_ph:l.get("passport_ph")||"",passportsecurity_ph:l.get("passportsecurity_ph")||"",passToken:l.get("passToken")||"",quality:"1.0",isRedirect:"true"},error:u,success:j.proxy(function(ak){ak=ak.replace("&&&START&&&","");ak=$.parseJSONSafe(ak);if(ak.result===0){$(".layeruploadface .preupload").hide();$(".layeruploadface .uploading .err_tip").hideError();$(".layeruploadface .uploading").show();var al=ak.info.tempUploadUrl;ag.action=al;ac.submit()}else{switch(ak.result){case 5200512:case 5200513:case 5000000:$(".layeruploadface .preupload .sys_err").showError(ak.result);break;default:}}},this)})},this));$(".naImgLink a, .na-edit").click(function(ac){ac.stopPropagation();ac.preventDefault();if(!x()){return}var ad=$(".layeruploadface");ad.find(".err_tip").hideError();ad.find("form").trigger("reset");$(ad.find(".mod_tip_bd").hide()[0]).show();ad.showPopup()});var z=100;$(".layeruploadface .uploaded .clipimg img").load(j.proxy(function(ag){if(!this.uploadingPhoto){return}var ae=$(ag.target),ad=$(".layeruploadface .uploaded .movebox"),af=ae.parent();$(".layeruploadface .uploading").hide();$(".layeruploadface .uploaded .err_tip").hideError();$(".layeruploadface .uploaded").show();$("#img_cache").append(ae);var ac=ae.width();imgHeight=ae.height();var ai=Math.min(300,$(".layeruploadface .uploaded .clipimg").width());if(ac>imgHeight){if(ac>ai){imgHeight=Math.floor(imgHeight*ai/ac);ac=ai}}else{if(imgHeight>ai){ac=Math.floor(ac*ai/imgHeight);imgHeight=ai}}ae.css({width:ac+"px",height:imgHeight+"px"}).appendTo(af);$("#img_cache").html("");z=Math.min(100,Math.min(ae.width(),ae.height()));ae.css("top",Math.floor((ai-ae.prop("offsetHeight"))/2));ae.css("left",Math.floor((ai-ae.prop("offsetWidth"))/2));var ah=Math.floor((ai-z)/2);ad[0].style.cssText="width:"+z+"px;height:"+z+"px;top:"+ah+"px;left:"+ah+"px;";this.uploadingPhoto=false},this));var N=$("#uploadPhoto"),M=N[0];var aa="";function S(ad){var ac=$("<DIV/>").html(ad);var ae=ac.text();ac=null;return ae}function Q(ag){if(M.readyState==="complete"||M.readyState==="loaded"||(ag&&ag.type==="load")){aa="";var af;try{af=M.contentDocument||(M.contentWindow&&M.contentWindow.document)||M.document;if(!af){return}}catch(ad){return}var ah=S($(af).find("textarea.jsonResult").val());var ae=ah;ae=ae.replace("&&&START&&&","");ae=$.parseJSONSafe(ae);if(!ae){$(".layeruploadface .uploading .sys_err").showError();return}if(ae.result===0){aa=S($(af).find("textarea.uploadResult").val());var ac=ae.info.data.temp_url;$(".layeruploadface .uploaded .clipimg img").attr("src",ac)}else{if(ae.result===1200521){if(ae.info){ae.result=ae.info.issErrorCode}}switch(ae.result){case 90021:$(".layeruploadface .uploading .file_too_large").showError(ae.result);break;case 90018:$(".layeruploadface .uploading .wng_fmt").showError(ae.result);break;case 5200522:case 5200524:case 5000000:$(".layeruploadface .uploading .sys_err").showError(ae.result);break;case 1200523:$(".layeruploadface .uploading .missing_param").showError(ae.result);break;case 80017:$(".layeruploadface .uploading .missing_file").showError(ae.result);break;case 10007:$(".layeruploadface .uploading .unsupported_mime_type").showError(ae.result);break;default:}}}}if("onreadystatechange" in M){M.onreadystatechange=Q}else{M.onload=Q}var I=false;var W,U;var ab=$(".movebox"),L=ab[0];var X=$(".uploadimgs img");function V(ac){if(ac.type.indexOf("touch")>-1){if(ac.originalEvent.touches&&ac.originalEvent.touches.length){return{pageX:ac.originalEvent.touches[0].pageX,pageY:ac.originalEvent.touches[0].pageY}}}else{return{pageX:ac.pageX,pageY:ac.pageY}}}ab.bind("mousedown touchstart",function(ad){ad.preventDefault();ad.stopPropagation();I=true;var ac=V(ad);W=ac.pageX-parseInt(ab.css("left"));U=ac.pageY-parseInt(ab.css("top"))});$(document).bind("mousemove touchmove",function(af){if(I){af.preventDefault();af.stopPropagation();if($(window).innerWidth()<=770&&af.target!==L){I=false;return}var ae=parseInt(X.css("left"),10),ak=ae+X.prop("offsetWidth")-ab.prop("offsetWidth");var aj=parseInt(X.css("top"),10),ac=aj+X.prop("offsetHeight")-ab.prop("offsetHeight");var al=V(af);var ai=al.pageX-W;var ah=al.pageY-U;if(ai<ae){ai=ae}if(ah<aj){ah=aj}if(ai>ak){ai=ak}if(ah>ac){ah=ac}var ag=Math.round((ai-ae)*100/(X.prop("offsetWidth")-ab.prop("offsetWidth")))+"%";var ad=Math.round((ah-aj)*100/(X.prop("offsetHeight")-ab.prop("offsetHeight")))+"%";ab.css({top:ah,left:ai})}}).bind("mouseup _touchend",function(ac){ac.preventDefault();I=false});var y=$(".layeruploadface .icon_square_rightbot"),R=y[0];var Z,E,Y=false;y.bind("mousedown touchstart",function(ad){ad.stopPropagation();ad.preventDefault();Y=true;var ac=V(ad);Z=ac.pageX-parseInt(y.css("left"),10);E=ac.pageY-parseInt(y.css("top"),10)});$(document).bind("mousemove touchmove",function(af){if(Y){af.stopPropagation();af.preventDefault();if($(window).innerWidth()<=770&&af.target!==R){Y=false;return}var al=V(af);var ah=al.pageX-Z;var ag=al.pageY-E;var ae=parseInt(X.css("left"),10),ak=ae+X.prop("offsetWidth")-parseInt(ab.css("left"),10);var aj=parseInt(X.css("top"),10),ac=aj+X.prop("offsetHeight")-parseInt(ab.css("top"),10);var ai=Math.max(ah,ag);var ad=ai;if(ad<z){ad=z}if(ad>ak){ad=ak}if(ad>ac){ad=ac}ad-=2;ab.css({height:ad,width:ad})}}).bind("mouseup _touchend",function(ac){if(Y){Y=false;ac.stopPropagation();ac.preventDefault()}});$(".layeruploadface .uploaded .btn_commom").click(function(ac){ac.preventDefault();if(!x()){return}$.ajax({url:"/pass/auth/profile/commitUpload",type:"POST",data:{userId:$(".na-num").text(),passport_ph:l.get("passport_ph")||"",passportsecurity_ph:l.get("passportsecurity_ph")||"",passToken:l.get("passToken")||"",uploadResult:aa,cropParam:(function(){var af=parseInt(X.css("left"),10),ah=X.prop("offsetWidth"),ak=ab.prop("offsetWidth");var al=parseInt(X.css("top"),10),ai=X.prop("offsetHeight"),am=ab.prop("offsetHeight");var ae=parseInt(ab.css("left"),10)-af,aj=parseInt(ab.css("top"),10)-al,ad=ae+ak,ag=aj+am;ae/=ah;aj/=ai;ad/=ah;ag/=ai;if(ae<0){ae=0}if(ae>1){ae=1}if(aj<0){aj=0}if(aj>1){aj=1}if(ad<0){ad=0}if(ad>1){ad=1}if(ag<0){ag=0}if(ag>1){ag=1}return'{"x1":'+ae+',"y1":'+aj+',"x2":'+ad+',"y2":'+ag+"}"})},dataType:"text",error:u,success:function(ad){ad=ad.replace("&&&START&&&","");ad=$.parseJSONSafe(ad);if(ad.result===0){$(".layeruploadface").showPopup();location.reload(true)}else{$(".layeruploadface .uploaded .err_tip").hideError();switch(ad.result){case 5200517:case 5200518:case 5200519:case 5200520:case 5000000:$(".layeruploadface .uploaded .sys_err").showError(ad.result);break;case 1200514:case 1200516:$(".layeruploadface .uploaded .bad_param").showError(ad.result);break;case 1200515:$(".layeruploadface .uploaded .upload_failed").showError(ad.result);break;default:}}}})});$(".layereditinfo .nickname").keypress(function(ac){if(ac.keyCode===13){ac.preventDefault();$(".layereditinfo .btn_commom").click()}})}});var e=j.$class({constructor:function(){},render:function(){this.uiBind()},uiBind:function(){},kick:function(){},onKick:function(){},requirePassword:function(){},untrust:function(){},onUntrust:function(){},findDevice:function(){},deleteRecord:function(){},editPassword:function(){}});var n=j.$class({constructor:function(){this.$bindingContainer=$("[_role=bindingContainer]");this.$a11nContainer=$("[_role=a11nContainer]")},render:function(){this.uiBind()},uiBind:function(){this.$bindingContainer.delegate("[_role=icon]","click",j.proxy(function(y){this.onClickBindingIcon($(y.target))},this));this.$a11nContainer.delegate("[_role=icon]","click",j.proxy(function(y){this.onClickA11NIcon($(y.target))},this))},onClickBindingIcon:function(z){var y=z.attr("_name");Util.showPopup(y)},onClickA11NIcon:function(z){var y=z.attr("_name");Util.showPopup(y)}});var a=j.$class({constructor:function(){},render:function(){this.uiBind()},uiBind:function(){}});var c=j.$class({constructor:function(){},showPopup:function(y){$(y).show()},hidePopup:function(y){$(y).hide()},fix:function(y){if($.browser.msie&&+$.browser.version<=6){y.css({position:"absolute"});var z=$(document);$win.bind("scroll resize",q.debounce(j.proxy(function(){y.css({top:z.scrollTop()+"px",left:z.scrollLeft()+"px"})},this),500))}}});var s=j.$class({constructor:function(y){y=y||{};this.sgp=y.sgp;this.phoneTip=new w(".phone_tip");this.phoneCaptTip=new w(".phone_capt_tip");this.smsTip=new w(".sms_tip");this.regTip=new w(".reg_tip");this.usageTip=new w(".usage_tip");this.photoTip=new w(".photo_tip");this.idTip=new w(".id_tip");this.passwordItemGroup=new g({max:3,parent:$("#passwords"),selector:".add_more",source:'<div class="add_more clearfix">'+$("#passwords .add_more").html()+"</div>",add:$("#passwords .add_more_link"),remove:$("#passwords .del_link")});this.emailItemGroup=new g({max:3,parent:$("#emails"),selector:".add_more",source:'<div class="add_more clearfix">'+$("#emails .add_more").html()+"</div>",add:$("#emails .add_more_link"),remove:$("#emails .del_link")});this.phoneItemGroup=new g({max:3,parent:$("#phones"),selector:".add_more",source:'<div class="add_more clearfix">'+$("#phones .add_more").html()+"</div>",add:$("#phones .add_more_link"),remove:$("#phones .del_link")});this.phoneModelItemGroup=new g({max:3,parent:$("#phone_models"),selector:".add_more",source:'<div class="add_more clearfix">'+$("#phone_models .add_more").html()+"</div>",add:$("#phone_models .add_more_link"),remove:$("#phone_models .del_link")});this.imeiItemGroup=new g({max:3,parent:$("#imeis"),selector:".add_more",source:'<div class="add_more clearfix">'+$("#imeis .add_more").html()+"</div>",add:$("#imeis .add_more_link"),remove:$("#imeis .del_link")});this.wifiItemGroup=new g({max:3,parent:$("#wifis"),selector:".add_more",source:'<div class="add_more clearfix">'+$("#wifis .add_more").html()+"</div>",add:$("#wifis .add_more_link"),remove:$("#wifis .del_link")})},uiBind:function(){$(".listtit").click(function(L){L.stopPropagation();$(".country-container").toggle()});$(document.body).click(function(L){$(".country-container").hide();A=false});$(".country-container").delegate(".record","click",function(Q){Q.stopPropagation();$(".country-container").hide();var R=$(Q.target).closest(".record");var N=R.find(".record-country");var L=R.find(".record-code");var P=$.trim(L.text()),M=$.trim(N.text()),O=N.data("code");$(".listtit").attr("_code",O).find("tt").text(M+"("+P+")")});$(".chkcode_img").click(function(M){M.stopPropagation();var L=M.target,N=L.getAttribute("_src");L.src=N+"&"+(+new Date);A=true});$("#phone").bind("focus click",j.proxy(function(L){this.phoneTip.hide();$("#appeal .shenhe_by_phone .phone_tip:not(.too_much)").hide();$(L.target).parent().removeClass("err_label")},this)).blur(j.proxy(function(M){this.phoneTip.hide();var L=$.trim(M.target.value);if(!L){this.phoneTip.show("empty_phone");$("#phone").parent().addClass("err_label")}else{if(!/^\d+$/.test(L)){this.phoneTip.show("wng_fmt");$("#phone").parent().addClass("err_label")}}},this));var A=false;$("#phone_capt").bind("focus click",j.proxy(function(L){this.phoneCaptTip.hide();$(L.target).parent().removeClass("err_label")},this)).blur(j.proxy(function(L){setTimeout(j.proxy(function(){if(A){return}this.phoneCaptTip.hide();var M=$.trim(L.target.value);if(!M){this.phoneCaptTip.show("empty_capt");$(L.target).parent().addClass("err_label")}},this),150)},this));$(".chkcode_img").click(function(L){$("#phone_capt").val("")});$("#resend").click(j.proxy(function(L){if($(L.target).hasClass("noSend")){return}sendResetTicket(true)},this));$(".resendcode").bind("focus click",j.proxy(function(L){this.smsTip.hide()},this)).blur(j.proxy(function(M){var L=$.trim($(".resendcode").val());if(!L){this.smsTip.show("empty_capt");$(".resendcode").parent().addClass("err_label")}},this));$("#validate").click(j.proxy(function(M){var L=$.trim($(".resendcode").val());if(!L){this.smsTip.show("empty_capt");$(".resendcode").parent().addClass("err_label");return}$.ajax({url:"/pass/retrieve/verifyPhoneContactAddress",type:"POST",dataType:"text",data:{externalId:$("#externalId").val(),vkey:L,contactAddress:($(".listtit").attr("_code")||"")+$("#phone").val()},error:u,success:j.proxy(function(N){N=$.parseJSONSafe(N.replace("&&&START&&&",""));if(N.code===0){this.nextTabPanel();this.nextTabHeader()}else{switch(N.code){case 70008:this.smsTip.show("wng_fmt");break;case 20003:this.smsTip.show("not_exists");break;case 70014:this.smsTip.show("wng_capt");$(".resendcode").val("").parent().addClass("err_label");break;case 10001:case 5000000:this.smsTip.show("sys_err");$(".resendcode").val("").parent().addClass("err_label");break;default:}}},this)})},this));var C=60000,B=60000;$("#back_to_sms").click(j.proxy(function(L){L.preventDefault();if(this.smsTimer){this.smsTimer.stop()}var M=$("#resend").attr("_text");if(M){$("#resend").text(M)}setTimeout(j.proxy(function(){this.phoneCaptTip.hide();$("#phone_capt").parent().removeClass("err_label");this.prevTabPanel()},this),100)},this));var H={};$("#submitPhone").click(j.proxy(function(Q){Q.preventDefault();this.phoneTip.hide();var R=$.trim($("#phone").val());if(!R){this.phoneTip.show("empty_phone");$("#phone").parent().addClass("err_label");return}else{if(!/^\d+$/.test(R)){this.phoneTip.show("wng_fmt");$("#phone").parent().addClass("err_label");return}}this.phoneCaptTip.hide();this.smsTip.hide();$(".resendcode").parent().removeClass("err_label");var M=$.trim($("#phone_capt").val());if(!M){this.phoneCaptTip.show("empty_capt");$("#phone_capt").parent().addClass("err_label");return}var O=$(".listtit").attr("_code")||"",T=$("#phone").val(),N=O+T;var S;if(!O){S="+86 "+T}else{S=O+" "+T}var P=window.sendResetTicket=j.proxy(function(V){var U={externalId:$("#externalId").val(),icode:$("#phone_capt").val(),contactAddress:N};if(!$(".shenhe_by_phone .inputcode:visible").length){delete U.icode}$.ajax({type:"POST",dataType:"text",url:"/pass/retrieve/phoneContactAddressConfirmMessage",data:U,error:u,success:j.proxy(function(W){W=$.parseJSONSafe(W.replace("&&&START&&&",""));this.phoneCaptTip.hide();this.phoneTip.hide();$("#phone").parent().removeClass("err_label");$("#phone_capt").parent().removeClass("err_label");switch(W.code){case 0:$(".shenhe_by_phone .inputcode").hide();$("#full_phone").val(N);$(".regbox .step2 em").text(S);var Z=$(".regbox .step2 #resend"),Y=Z.attr("_text");Z.addClass("noSend");var X=this.smsTimer=new q.Countdown({duration:B,onProgress:function(aa){Z.text(Y+"("+Math.round(aa.timeLeft/1000)+")")},onComplete:function(){Z.text(Y);if(H[N]>0){Z.removeClass("noSend")}}});B+=C;X.start();$(".resendcode").val();H[N]--;if(!V){this.nextTabPanel()}break;case 70021:this.phoneTip.show("mibao");$("#phone").val("").parent().addClass("err_label");$(".chkcode_img").click();break;case 70013:this.phoneTip.show("bound");$("#phone").val("").parent().addClass("err_label");$(".chkcode_img").click();break;case 20003:this.phoneTip.show("not_exists");$("#phone").val("").parent().addClass("err_label");$(".chkcode_img").click();break;case 20031:$(".shenhe_by_phone .inputcode").show();this.phoneTip.show("empty_capt");$("#phone_capt").parent().addClass("err_label");$(".chkcode_img").click();if(V){this.prevTabPanel()}break;case 20023:this.phoneTip.show("too_many");$("#phone").val("").parent().addClass("err_label");$(".chkcode_img").click();break;case 87001:$(".shenhe_by_phone .inputcode").show();this.phoneCaptTip.show("wng_capt");$("#phone_capt").parent().addClass("err_label");$(".chkcode_img").click();if(V){this.prevTabPanel()}break;case 70008:this.phoneTip.show("wng_fmt");$("#phone").val("").parent().addClass("err_label");$(".chkcode_img").click();break;case 70022:this.phoneTip.show("too_much");$(".chkcode_img").click();break;case 10001:case 5000000:this.phoneTip.show("sys_err");$(".chkcode_img").click();break;default:}},this)})},this);var L=0;if(H.hasOwnProperty(N)){L=H[N];if(L>0){P()}else{$("#quotaLabel").text(0).parent().show()}}else{$.ajax({data:{address:N,contentType:4000004,userId:-1},type:"POST",url:"/pass/sms/quota",dataType:"text",success:function(V){V=$.parseJSONSafe(V.replace("&&&START&&&",""));if(V.result===0){var U=H[N]=V.info;P()}else{switch(V.result){default:var U=H[N]=5;P()}}},error:function(){P()}})}},this));var J=$("#submitPhone"),F=$("#phone"),y=$("#prefix"),z=$("#appeal .shenhe_by_phone .too_much"),K=$("#quotaLabel"),D="0";setInterval(function(){var N=y.attr("_code")||"",L=F.val(),M=N+L;if(H.hasOwnProperty(M)){if(H[M]>0){z.hide();J.removeClass("disabled")}else{z.show();J.addClass("disabled")}if(H[M]<=2){K.text(Math.max(0,H[M])).parent().show()}else{K.text(0).parent().hide()}}else{z.hide();J.removeClass("disabled");K.text(0).parent().hide()}},1000);$("#serviceUsed-dom .checkbox_container").click(function(L){$(L.target).closest(".checkbox_container").toggleClass("now")});function G(){if($("#devices .othway").hasClass("now")||$("#wifis .input_kuang:not([value=]), #imeis .input_kuang:not([value=])").length){$("#var_btn").removeClass("disabled")}else{$("#var_btn").addClass("disabled")}}$("#devices .othway").click(function(L){$(L.currentTarget).toggleClass("now");G()});$("#phone_models, #imeis").bind("keypress click",G);setInterval(G,1000);$("#YearLocation-dom .del_link").click(function(O){var M=$("#YearLocation-dom");var N=M.find(".areapick_container .areapicker");var L=N.length;if(L>1){$(N[L-1]).remove()}L--;if(L<2){$(O.target).hide()}$("#YearLocation-dom .add_more_link").show()});$("#YearLocation-dom .add_more_link").click(function(Q){var M=$("#YearLocation-dom");var P=M.find(".areapick_container");var O=$('<div class="areapicker c_b"/>').html(P.find(".areapicker-tmpl").html()).appendTo(P);selectArea(O);$("#YearLocation-dom .del_link").show();var N=M.find(".areapick_container .areapicker");var L=N.length;if(L>=3){$(Q.target).hide()}$("#YearLocation-dom .i_selectoption > dd:first-child").hide()});$("#reg_by").change(j.proxy(function(M){var L=+M.target.value;switch(L){case -1:case 1:$("#reg_via").parent().show();$("#reg_via2").parent().hide();$("#reg_via3").parent().hide();break;case 2:$("#reg_via2").parent().show();$("#reg_via3").parent().hide();$("#reg_via").parent().hide();break;case 0:$("#reg_via3").parent().show();$("#reg_via").parent().hide();$("#reg_via2").parent().hide();break;default:}$("#registerWay-dom .reg_by").hide();if(L!==-1){this.regTip.hide("reg_by")}},this));$("#reg_via, #reg_via2, #reg_via3").change(j.proxy(function(M){$("#registerWay-dom .reg_via").hide();var L=+M.target.value;if(L!==-1){this.regTip.hide("reg_via")}},this));$("#submit_reg").click(j.proxy(function(O){this.regTip.hide();var L=+$("#reg_by").val();if(L===-1){this.regTip.show("reg_by");return}var N;if(L===1){N=+$("#reg_via").val()}else{if(L===2){N=+$("#reg_via2").val()}else{N=+$("#reg_via3").val()}}if(N===-1){this.regTip.show("reg_via");return}var P=false;$(".areapicker").each(function(T,aa){var Y=$(aa);var U=Y.find(".year"),W=Y.find(".country"),Z=Y.find(".province"),R=Y.find(".city");var Q=U.prop("selectedIndex"),V=W.prop("selectedIndex"),X=Z.prop("selectedIndex"),S=R.prop("selectedIndex");if(Q&&V){P=true;return false}});if(!P){this.regTip.show("area");return}var M=!!($(".checkbox_container.now").length||$(".checkbox_more label input").val());if(!M){this.regTip.show("service");return}this.nextTabHeader();this.nextTabPanel()},this));$("#back_to_reg").click(j.proxy(function(L){L.preventDefault();if(!$("#devices .othway").hasClass("now")){this.prevTabPanel();this.prevTabHeader()}else{this.nextTabPanel();this.nextTabHeader()}},this));$("#back_to_devices").click(j.proxy(function(L){L.preventDefault();this.prevTabPanel();this.prevTabHeader()},this));$("#back_to_usage").click(j.proxy(function(L){L.preventDefault();this.prevTabPanel();this.prevTabHeader()},this));$("#var_btn").click(j.proxy(function(M){var N=$(M.currentTarget);if(N.hasClass("disabled")){return}if($("#devices .othway").hasClass("now")){this.nextTabHeader();this.nextTabPanel();$("#imeis .input_kuang").each(function(O,P){if(!/^\d*$/.test(P.value)){P.value=""}});return}this.usageTip.hide();$("#phone_models .labelbox, #imeis .labelbox, #wifis .labelbox").removeClass("err_label");var L=false;$("#imeis .input_kuang").each(function(O,P){var Q=$.trim(P.value);if(Q&&!/^\d+$/.test(Q)){L=true;$(P).parent().addClass("err_label");return false}});if(L){this.usageTip.show("wng_imei_fmt");return}this.nextTabHeader();this.nextTabPanel()},this));$("#usage_btn").click(j.proxy(function(Q){this.usageTip.hide();$("#passwords .labelbox, #emails .labelbox, #phones .labelbox").removeClass("err_label");var N=false;$("#emails .input_kuang").each(function(T,U){var V=$.trim(U.value);if(V&&!/^[\w.\-]+@(?:[a-z0-9]+(?:-[a-z0-9]+)*\.)+[a-z]{2,6}$/.test(V)){N=true;$(U).parent().addClass("err_label");return false}});if(N){this.usageTip.show("wng_email_fmt");return}$("#phones .input_kuang").each(function(T,U){var V=$.trim(U.value);if(V&&!/^\+?\d+$/.test(V)){N=true;$(U).parent().addClass("err_label");return false}});if(N){this.usageTip.show("wng_phone_fmt");return}this.regTip.hide();var L=+$("#reg_by").val();if(L===-1){this.regTip.show("reg_by");return}var P;if(L===1||L===0){P=+$("#reg_via").val()}else{if(L===2){P=+$("#reg_via2").val()}else{P=+$("#reg_via3").val()}}if(P===-1){this.regTip.show("reg_via");return}var S=true,M=true,R=true;$(".areapicker").each(function(W,ad){var ab=$(ad);var X=ab.find(".year"),Z=ab.find(".country"),ac=ab.find(".province"),U=ab.find(".city");var T=X.prop("selectedIndex"),Y=Z.prop("selectedIndex"),aa=ac.prop("selectedIndex"),V=U.prop("selectedIndex");if(!T){M=false}if(!Y){R=false}if(!(T&&Y)){S=false;return false}});if(!M){this.regTip.show("year");return false}if(!R){this.regTip.show("locale");return false}if(!S){this.regTip.show("area");return}var O=!!($(".checkbox_container.now").length||$(".checkbox_more label input").val());if(!O){this.regTip.show("service");return}this.submit()},this));$("#id_type").change(j.proxy(function(M){var L=+M.target.value;if(L){this.idTip.hide("empty_id_type")}},this));$("#final_btn").click(j.proxy(function(L){if($("#devices .othway").hasClass("now")){this.idTip.hide();if(!+$("#id_type").val()){this.idTip.show("empty_id_type");return}if(!$("#id_value").val()){this.idTip.show("empty_id_value");return}if(!$("#photoId").val()){this.idTip.show("empty_id_photo");return}this.nextTabHeader();this.nextTabPanel();return}this.nextTabHeader();this.nextTabPanel()},this));$("#emails").delegate(".err_label","click focus",j.proxy(function(L){$(".wng_email_fmt").hide()},this));$("#phones").delegate(".err_label","click focus",j.proxy(function(L){$(".wng_phone_fmt").hide()},this));$("#imeis").delegate(".err_label","click focus",j.proxy(function(L){$(".wng_imei_fmt").hide()},this));$(document.body).delegate(".err_label","click focus",function(L){$(L.target).closest(".err_label").removeClass("err_label")});var E=this;window.uploadSuccess=function(){var O=window.frames&&window.frames.uploadIframe;if(!O||!O.data){return}var N=O.data;var M=N.tempId;var P=N.data;if(M!=$("#imgId").val()){return}clearTimeout(E.uploadTimeout);$("#timeout_mes").hide();$("#loading").hide();$("#photoId").val(P.mfsFileId);if(!P.success){switch(P.errorCode){case 20003:E.photoTip.show("not_exists");break;case 20005:E.photoTip.show("wng_fmt");break;case 10012:case 10001:E.photoTip.show("sys_err");break;case 80004:E.photoTip.show("file_too_large");break;default:E.photoTip.show("error")}}else{E.photoTip.hide();$("#img_area").attr("src","/pass/retrieve/photo/download?externalId="+$("#externalId").val()+"&mfsFileId="+P.mfsFileId+"&photoKey="+P.authkey);var L=$("#fileUpload");var Q=L.attr("_retext");$("#fileButton").text(Q);L.val(Q)}};$("#img_area").bind("load error",function(L){$("#img_area").show()});$("#fileUpload").change(j.proxy(function(S){var M=S.target,P=M.form,Q=M.value;if(Q){var R=Q.lastIndexOf(".");if(R!==-1){var N=Q.substring(R+1).toLowerCase();if(N!=="png"&&N!=="jpg"){E.photoTip.show("wng_fmt");$("#img_area").hide();return}}var O=M.files;if(O&&O.length){var L=O[0];if(L.size>5<<20){E.photoTip.show("file_too_large");$("#img_area").hide();return}}$("#imgId").val(+new Date);$(P).trigger("submit");$("#loading").show();$("#img_area").hide();$("#timeout_mes").hide();$("#error_mes").hide();this.uploadTimeout=setTimeout(j.proxy(function(){$("#loading").hide();$("#imgId").val(+new Date);$("#timeout_mes").show()},this),60000)}},this));$("#phone, #phone_capt").bind("keypress",function(L){if(L.keyCode===13){$("#submitPhone").click()}});$(".resendcode").bind("keypress",function(L){if(L.keyCode===13){$("#validate").click()}});$('input[name="moreServices"]').bind("keypress",function(L){if(L.keyCode===13){$("#submit_reg").click()}});$(document.body).delegate('input[name="passwordUsed"], input[name="bindEmailUsed"], input[name="bindPhoneUsed"], input[name="mobilePhoneModel"], input[name="androidPhoneIMEI"], input[name="iphoneWIFI"]',"keypress",function(L){if(L.keyCode===13){$("#var_btn").click()}});$("#id_value").bind("keypress",function(L){if(L.keyCode===13){$("#final_btn").click()}});$("#reg_by + .i_selectbox .i_currentselected").click(function(){$(".regVia .i_selectoption, #YearLocation-dom .i_selectoption").hide()});$(".regVia .i_currentselected").click(function(){$("#reg_by + .i_selectbox .i_selectoption, #YearLocation-dom .i_selectoption").hide()});$("#YearLocation-dom").delegate(".i_currentselected","click",function(L){$("#registerType-dom .i_selectoption, #registerWay-dom .i_selectoption").hide()});var I=document.getElementById("imeis");setInterval(function(){var M=I.getElementsByTagName("input");for(var O=0,L=M.length;O<L;O++){var N=M[O];N.value=N.value.replace(/\D/g,"")}M=null},500)},render:function(){this.uiBind();var z=$("#resend");z.attr("_text",z.text());this.decoSelect("select[_decorable]");this.decoYearSelect("select.year");$("#YearLocation-dom .areapicker").each(function(B,C){var A=$(C);selectArea(A)});$(".chkcode_img").click();this.passwordItemGroup.render();this.emailItemGroup.render();this.phoneItemGroup.render();this.phoneModelItemGroup.render();this.imeiItemGroup.render();this.wifiItemGroup.render();if(this.sgp){$(".othway").hide()}var y=$("#usage");$("#appeal").append(y);$("#uploadImgForm").appendTo("#nested").show();$("#YearLocation-dom .i_selectoption > dd:first-child").hide()},nextnextTabHeader:function(){var z=$(".tab_opt > span");var y=z.filter(".now").index("span");$(z.removeClass("now")[y+2]).addClass("now");var A=$(".tabline > i");$(A.removeClass("now")[y+2]).addClass("now");window.scrollTo(0,0)},nextTabHeader:function(){var z=$(".tab_opt > span");var y=z.filter(".now").index("span");$(z.removeClass("now")[y+1]).addClass("now");var A=$(".tabline > i");$(A.removeClass("now")[y+1]).addClass("now");window.scrollTo(0,0)},prevprevTabHeader:function(){var z=$(".tab_opt > span");var y=z.filter(".now").index("span");$(z.removeClass("now")[y-2]).addClass("now");var A=$(".tabline > i");$(A.removeClass("now")[y-2]).addClass("now");window.scrollTo(0,0)},prevTabHeader:function(){var z=$(".tab_opt > span");var y=z.filter(".now").index("span");$(z.removeClass("now")[y-1]).addClass("now");var A=$(".tabline > i");$(A.removeClass("now")[y-1]).addClass("now");window.scrollTo(0,0)},nextnextTabPanel:function(){var z=$("#appeal .bd");var y=z.filter(":visible").index(".bd");$(z.hide()[y+2]).show();window.scrollTo(0,0)},nextTabPanel:function(){var z=$("#appeal .bd");var y=z.filter(":visible").index(".bd");$(z.hide()[y+1]).show();window.scrollTo(0,0)},prevTabPanel:function(){var z=$("#appeal .bd");var y=z.filter(":visible").index(".bd");$(z.hide()[y-1]).show();window.scrollTo(0,0)},prevprevTabPanel:function(){var z=$("#appeal .bd");var y=z.filter(":visible").index(".bd");$(z.hide()[y-2]).show();window.scrollTo(0,0)},decoSelect:function(y){var z=$(y);z.iSimulateSelect();$(".i_currentselected, i_selectoption, .i_selectoption").css("width","100%");$(".i_selectoption > dd:first-child").hide()},appendSelect:function(y,z){$(z).append(decoSelect(y))},prependSelect:function(y,z){$(z).prepend(decoSelect(y))},decoYearSelect:function(y){$(y).each(function(A,C){var z=C.options;z.length=1;var B=new Date().getFullYear();for(var E=B;E>=2012;E--){var D=$('<option value="'+E+'">'+E+"</option>").appendTo(C)}})},submit:function(){var C="";switch(+$("#reg_by").val()){case -1:case 1:C=$("#reg_via").val();break;case 2:C=$("#reg_via2").val();break;case 0:C=$("#reg_via3").val();break;default:}$("#reg_way").val(C);$('#devices [name="androidPhoneIMEI"], #devices [name="iphoneWIFI"]').each(function(D,E){var F=$.trim(E.value);if(!F){$(E).remove()}});var A=$("#services .checkbox_container.now");var y=$("#services .serviceUsed");A.each(function(D,E){var F=$(E).find(".icon_select").attr("value");y.filter('[value="'+F+'"]').prop("checked",true)});var B=$("#locations .areapicker"),z=$("#locations .frequentlyLoginLocation");B.each(function(F,M){var K=$(M);var G=K.find(".year"),H=K.find(".country"),L=K.find(".province"),E=K.find(".city");var I=G.val(),D=H.val();if(I&&D){var J=[G.val(),H.val(),L.val(),E.val()].join("-");$(z[F]).val(J)}});$("#appeal").trigger("submit")}});var g=j.$class({constructor:function(y){this.$parent=$(y.parent||y.$parent);this.selector=y.selector;this.source=y.source;this.$add=$(y.add||y.$add);this.$remove=$(y.remove||y.$remove);this.min="min" in y?y.min:1;this.max="max" in y?y.max:Number.MAX_VALUE},items:function(){return this.$parent.children(this.selector)},size:function(){return this.items().length},uiBind:function(){this.$add.click(j.proxy(function(y){y.preventDefault();this.add()},this));this.$remove.click(j.proxy(function(y){y.preventDefault();this.remove()},this))},add:function(){var y=this.items(),z=y.length;if(z<this.max){var B=$(this.source);var A=$(y[z-1]);if(A.length){A.after(B)}else{this.$parent.append(B)}}this.$remove.show();if(z+1>=this.max){this.$add.hide()}},remove:function(){var y=this.items(),z=y.length;if(z>this.min){$(y[z-1]).remove()}this.$add.show();if(z-1<=this.min){this.$remove.hide()}},render:function(){this.uiBind();var y=this.size();if(y<=this.min){this.$remove.hide()}else{this.$remove.show()}if(y>=this.max){this.$add.hide()}else{this.$add.show()}}});var m=j.$class({constructor:function(y){y=y||{};this.$idBox=$("#externalId");this.$form=this.$idBox.closest("FORM");this.idTip=new w(".id_tip")},render:function(){this.uiBind()},uiBind:function(){this.$idBox.bind("click focus",j.proxy(function(y){this.idTip.hide();this.$idBox.parent().removeClass("err_label")},this));this.$form.submit(j.proxy(function(z){var A=$.trim(this.$idBox.val());if(!A){this.idTip.show("empty_id");this.$idBox.parent().addClass("err_label");return false}var y=new RegExp(this.$idBox.attr("rule"));if(!y.test(A)){this.idTip.show("wng_fmt");this.$idBox.parent().addClass("err_label");return false}A=A.replace(/^\+86/,"");this.$idBox.val(A)},this))}});return{Security:f,Profile:t,LoginManager:e,BindingA11N:n,Services:a,Utils:c,AppealForm:s,PreappealForm:m}});